<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Java Class 文件解析 | DnF's Zone</title><meta name=keywords content="jdk,jvm,class,字节码"><meta name=description content="
简介 
.java 文件编译后的 .class 文件内容究竟是怎样的？JVM 又是如果识别并加载 .class 文件的。"><meta name=author content="DnF"><link rel=canonical href=https://zone.dnfn.tech/post/20210608875210/><link crossorigin=anonymous href=/assets/css/stylesheet.min.2282d1157d794f784bf9f62038687785053b90d8a0d04ecf047df2b7852bb448.css integrity="sha256-IoLRFX15T3hL+fYgOGh3hQU7kNig0E7PBH3yt4UrtEg=" rel="preload stylesheet" as=style><link rel=preload href=/favicon.svg as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://zone.dnfn.tech/favicon.svg><link rel=icon type=image/png sizes=16x16 href=https://zone.dnfn.tech/favicon.svg><link rel=icon type=image/png sizes=32x32 href=https://zone.dnfn.tech/favicon.svg><link rel=apple-touch-icon href=https://zone.dnfn.tech/apple-touch-icon.png><link rel=mask-icon href=https://zone.dnfn.tech/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.83.1"><meta property="og:title" content="Java Class 文件解析"><meta property="og:description" content="
简介 
.java 文件编译后的 .class 文件内容究竟是怎样的？JVM 又是如果识别并加载 .class 文件的。"><meta property="og:type" content="article"><meta property="og:url" content="https://zone.dnfn.tech/post/20210608875210/"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-06-08T19:52:10+08:00"><meta property="article:modified_time" content="2021-06-08T19:52:10+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Java Class 文件解析"><meta name=twitter:description content="
简介 
.java 文件编译后的 .class 文件内容究竟是怎样的？JVM 又是如果识别并加载 .class 文件的。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://zone.dnfn.tech/post/"},{"@type":"ListItem","position":3,"name":"Java Class 文件解析","item":"https://zone.dnfn.tech/post/20210608875210/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Java Class 文件解析","name":"Java Class 文件解析","description":"简介  .java 文件编译后的 .class 文件内容究竟是怎样的？JVM 又是如果识别并加载 .class 文件的。\n","keywords":["jdk","jvm","class","字节码"],"articleBody":"简介  .java 文件编译后的 .class 文件内容究竟是怎样的？JVM 又是如果识别并加载 .class 文件的。\n环境 Win10、Nixos\nJDK1.8\nClass文件内容 windows 下用 Powershell 查看字节码内容(十六进制)\nPS cat Demo.java; public class Demo{} PS javac.exe Demo.java; Format-Hex Demo.class Path: D:\\tmp\\java\\Demo.class 00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 00000000 CA FE BA BE 00 00 00 34 00 0D 0A 00 03 00 0A 07 Êþº¾...4........ 00000010 00 0B 07 00 0C 01 00 06 3C 69 6E 69 74 3E 01 00 ........init.. 00000020 03 28 29 56 01 00 04 43 6F 64 65 01 00 0F 4C 69 .()V...Code...Li 00000030 6E 65 4E 75 6D 62 65 72 54 61 62 6C 65 01 00 0A neNumberTable... 00000040 53 6F 75 72 63 65 46 69 6C 65 01 00 09 44 65 6D SourceFile...Dem 00000050 6F 2E 6A 61 76 61 0C 00 04 00 05 01 00 04 44 65 o.java........De 00000060 6D 6F 01 00 10 6A 61 76 61 2F 6C 61 6E 67 2F 4F mo...java/lang/O 00000070 62 6A 65 63 74 00 21 00 02 00 03 00 00 00 00 00 bject.!......... 00000080 01 00 01 00 04 00 05 00 01 00 06 00 00 00 1D 00 ................ 00000090 01 00 01 00 00 00 05 2A B7 00 01 B1 00 00 00 01 .......*·..±.... 000000A0 00 07 00 00 00 06 00 01 00 00 00 01 00 01 00 08 ................ 000000B0 00 00 00 02 00 09 ...... Linux 下命令行查看\n$ cat IDemo.java public interface IDemo{} $ javac IDemo.java ; hexdump IDemo.class 0000000 feca beba 0000 3400 0700 0007 0705 0600 0000010 0001 530a 756f 6372 4665 6c69 0165 0a00 0000020 4449 6d65 2e6f 616a 6176 0001 4905 6544 0000030 6f6d 0001 6a10 7661 2f61 616c 676e 4f2f 0000040 6a62 6365 0674 0001 0001 0002 0000 0000 0000050 0000 0001 0003 0000 0002 0004 000005b 这里大小端是相反的。\nClass文件结构 一个完整的 class 文件大致可分为10个部分\n 魔数 版本号 常量池\n3.1 常量池计数器\n3.2 常量池数据区 访问标志 类索引 父类索引 接口\n7.1 接口计数器\n7.2 接口信息区 字段\n8.1 字段计数器\n8.2 字段信息区 方法\n9.1 方法计数器\n9.2 方法信息区 属性\n10.1 属性计数器\n10.2 属性信息区  关于class 文件的基本数据结构在 The Java Virtual Machine Specification (Second ed.)文档有详细的说明，如下:\nstruct Class_File_Format { u4 magic_number; u2 minor_version; u2 major_version; u2 constant_pool_count; cp_info constant_pool[constant_pool_count - 1]; u2 access_flags; u2 this_class; u2 super_class; u2 interfaces_count; u2 interfaces[interfaces_count]; u2 fields_count; field_info fields[fields_count]; u2 methods_count; method_info methods[methods_count]; u2 attributes_count; attribute_info attributes[attributes_count]; } u4: 指4个字节的无符号整型\nu2: 指2个字节的无符号整型\n而cp_info、field_info、method_info、attribute_info 表示相关数据结构，长度均不定可变\nmagic_number 魔数(magic_number)是指某一文件格式下前几个固定字节值，一般用于识别文件格式，class文件的魔数固定为前4个字节，即：CA FE BA BE。\n至于它的来源和背后的故事可以看看 Wiki - Java class file 下的 Magic Number\nminor_version,major_version minor_version,major_version统称版本号，共占用4个字节，各分为2个字节的次版本号(minor_version)占第5、6字节位以及占第7、8字节位的主版本号(major_version)。版本号的作用为标识 class 文件是在具体哪个版本的 JVM 下生成的，让运行时环境的JVM确认是否可以加载此版本的class文件。\n以下常见主版本号(major_version)\n Java SE 17 = 61 (0x3D hex),\nJava SE 16 = 60 (0x3C hex),\nJava SE 15 = 59 (0x3B hex),\nJava SE 14 = 58 (0x3A hex),\nJava SE 13 = 57 (0x39 hex),\nJava SE 12 = 56 (0x38 hex),\nJava SE 11 = 55 (0x37 hex),\nJava SE 10 = 54 (0x36 hex),\nJava SE 9 = 53 (0x35 hex),\nJava SE 8 = 52 (0x34 hex),\nJava SE 7 = 51 (0x33 hex),\nJava SE 6.0 = 50 (0x32 hex),\nJava SE 5.0 = 49 (0x31 hex),\nJDK 1.4 = 48 (0x30 hex),\nJDK 1.3 = 47 (0x2F hex),\nJDK 1.2 = 46 (0x2E hex),\nJDK 1.1 = 45 (0x2D hex).\n 常量池 常量池分为两个数据字段：constant_pool_count(计数器)+constant_pool(数据结构数组)。存储了整个class文件下的字面量信息1，包括：各类型的数字、字符串、类引用、方法引用、字段引用和方法句柄等其他常量。\nconstant_pool_count 常量池计数器（实际并不是数量），它的值：constant_pool_count = constant_pool实体的数量 + 1，这一点与其他的池不同，constant_pool的索引在(0,constant_pool_count)之间（不包含）。总共占2个无符号字节。数值0表示为未引用任何对象。\n以前面win下的例子来说：\n00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 00000000 CA FE BA BE 00 00 00 34 00 0D 0A 00 03 00 0A 07 Êþº¾...4........ 00 0D也就是13，但常量池数量需要减1，所以是12。\nconstant_pool constant_pool_count只是常量池的计数器，实际数据在constant_pool数组中。constant_pool也就是实际意义上的常量池，长度不定。数组中每一个元素数据结构为：\ncp_info { u1 tag; u1 info[]; }  tag：常量的类型 info：常量信息  常量信息info是一个不确定数组，不同的tag也就是常量类型，info数组长度是不一样，每个常量类型的info都是固定的或可计算的，而对于字符串等不定长的结构，通常都是采取分为两个字段表示（实际上池也是）：一个长度，一个数组。\n相关的tag类型:\n\n需要注意的几个结构：\n因为在class文件中，大多数信息最终都会用字符串内容表示，所以字符串内容无疑是最基本的结构之一。\nCONSTANT_Utf8_info { u1 tag; u2 length; u1 bytes[length]; } CONSTANT_Utf8_info 也就是我们常说的字符串常量（utf8编码过后的内容），它在tag之后的两个字节为无符号数值，它表示了这个字符串的UTF-8编码后的字节数组长度，即bytes的大小。这里不深入bytes存储的具体内容和方式，详细可查看原文档。\n然后是CONSTANT_String_info：\nCONSTANT_String_info { u1 tag; u2 string_index; } CONSTANT_Utf8_info用来表示常量字符串的内容，而CONSTANT_String_info则表示常量字符串对象，即为产生的Object。对象的实际内容通过string_index指向实际的CONSTANT_Utf8_info。\n常量池中大多数都是依赖一个index指向实际的CONSTANT_Utf8_info来表示（数值直接通过字节表示）。\n例如，类：\nCONSTANT_Class_info { u1 tag; u2 name_index; } name_index实际就是一个CONSTANT_Utf8_info的索引。\n再比如，方法、字段等：\nCONSTANT_Fieldref_info { u1 tag; u2 class_index; u2 name_and_type_index; } CONSTANT_Methodref_info { u1 tag; u2 class_index; u2 name_and_type_index; } CONSTANT_InterfaceMethodref_info { u1 tag; u2 class_index; u2 name_and_type_index; } 这里的class_index指的是constant_pool中一个具体的CONSTANT_Class_info的索引，而name_and_type_index指的其中具体某一个CONSTANT_NameAndType_info，其结构如下：\nCONSTANT_NameAndType_info { u1 tag; u2 name_index; u2 descriptor_index; } 它包含的name_index和descriptor_index是两个CONSTANT_Utf8_info在常量池的索引。\n以前面win下的例子来看：\n00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 00000000 CA FE BA BE 00 00 00 34 00 0D 0A 00 03 00 0A 07 Êþº¾...4........ 00000010 00 0B 07 00 0C 01 00 06 3C 69 6E 69 74 3E 01 00 ........init.. 00000020 03 28 29 56 01 00 04 43 6F 64 65 01 00 0F 4C 69 .()V...Code...Li 00000030 6E 65 4E 75 6D 62 65 72 54 61 62 6C 65 01 00 0A neNumberTable... 00000040 53 6F 75 72 63 65 46 69 6C 65 01 00 09 44 65 6D SourceFile...Dem 00000050 6F 2E 6A 61 76 61 0C 00 04 00 05 01 00 04 44 65 o.java........De 00000060 6D 6F 01 00 10 6A 61 76 61 2F 6C 61 6E 67 2F 4F mo...java/lang/O 00000070 62 6A 65 63 74 00 21 00 02 00 03 00 00 00 00 00 bject.!......... 共计12个常量，简单说明几个：\n第1个：0A 00 03 00 0A，tag：0A(CONSTANT_Methodref_info)，info[4]：00 03 00 0A。\nCONSTANT_Methodref_info { u1 tag; // `0A`  u2 class_index; // `00 03`  u2 name_and_type_index; // `00 0A` } 第3个：07 00 0C\nCONSTANT_Class_info { u1 tag; // 07  u2 name_index; // 00 0C } 第10个：0C 00 04 00 05\nCONSTANT_NameAndType_info { u1 tag; // 0C  u2 name_index; // 00 04  u2 descriptor_index; //00 05 } 第12个：01 00 10 6A 61 76 61 2F 6C 61 6E 67 2F 4F 62 6A 65 63 74\nCONSTANT_Utf8_info { u1 tag; // 01  u2 length; // 00 10  u1 bytes[length]; // 6A 61 76 61 2F 6C 61 6E 67 2Fj 4F 62 6A 65 63 74 } 这里直接通过 javap 查看class文件的编译字节信息\nPS javap -v Demo.class Classfile D:\\tmp\\java\\Demo.class Last modified 2021-6-19; size 182 bytes MD5 checksum 626255e824a12d768af074fcb588b1d3 Compiled from \"Demo.java\" public class Demo minor version: 0 major version: 52 flags: ACC_PUBLIC, ACC_SUPER Constant pool: #1 = Methodref #3.#10 // java/lang/Object.\"init\":()V #2 = Class #11 // Demo #3 = Class #12 // java/lang/Object #4 = Utf8 init #5 = Utf8 ()V #6 = Utf8 Code #7 = Utf8 LineNumberTable #8 = Utf8 SourceFile #9 = Utf8 Demo.java #10 = NameAndType #4:#5 // \"init\":()V #11 = Utf8 Demo #12 = Utf8 java/lang/Object { public Demo(); descriptor: ()V flags: ACC_PUBLIC Code: stack=1, locals=1, args_size=1 0: aload_0 1: invokespecial #1 // Method java/lang/Object.\"init\":()V 4: return LineNumberTable: line 1: 0 } SourceFile: \"Demo.java\" 第12个常量对应java/lang/Object，第4和5个常量为和()V，所以第一个变量是java/lang/Object.\"\":()V，实际指向类Object编译的初始化方法。\n接口常量就更加少了，这里不再继续说明了。\naccess_flags access_flags为访问标志，共2个字节，用于表示某个类或者接口的访问权限及基础属性。\n详细内容可查看《Java虚拟机原理图解》 1.1、class文件基本组织结构。\n\n以前面的例子来看：\n00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 00000070 62 6A 65 63 74 00 21 00 02 00 03 00 00 00 00 00 bject.!......... 即：ACC_SUPER+ACC_PUBLIC\nthis_class 当前类索引，即当前类或者接口在constant_pool中的位置索引。\n以之前的例子来看：\n00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 00000070 62 6A 65 63 74 00 21 00 02 00 03 00 00 00 00 00 bject.!......... 00 02即是第2个，参见上文。\nsuper_class 父类索引，即当前类的父类在constant_pool中的索引。\n以之前的例子来看：\n00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 00000070 62 6A 65 63 74 00 21 00 02 00 03 00 00 00 00 00 bject.!......... 父类为第3个常量class，也就是Object。\n对于Object(没有父类)，则索引为0。\n对于接口：\n00000040 65 63 74 06 01 00 01 00 02 00 00 00 00 00 00 00 ect............. // javap -v Demo.class #2 = Class #6 // java/lang/Object 只能是Object。\n接口表 interfaces_count 接口计数器，占两个字节，interfaces_count的值表示当前类或接口的直接父接口数量。可为0。\ninterfaces 接口数组，长度为interfaces_count。数组中每一个元素必须是constant_pool中的一个CONSANT_Class_info常量。存储顺序与代码中提供的接口顺序相同。\n上文无接口时，表示为\n00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 00000070 62 6A 65 63 74 00 21 00 02 00 03 00 00 00 00 00 bject.!......... 只有接口计数器的值00 00\n字段表 字段表同样由两个部分组成：fields_count和fields。\nfields_count 字段计数器，共2个字节，表示当前Class文件fields数组的长度。可以为0。\nfields 字段数组，字节大小不定，元素结构为field_info，长度为fields_count。只包含当前class文件定义的字段，继承的部分不在其中。\nfield_info结构：\nfield_info { u2 access_flags; u2 name_index; u2 descriptor_index; u2 attributes_count; attribute_info attributes[attributes_count]; } 其中name_index和descriptor_index都是constant_pool的一个CONSTANT_Utf8_info索引。\nattributes结构与class文件的attributes结构一致，后文再讲。\n当fields_count为0时，和接口表一样不会有数据区fields:\n00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 00000070 62 6A 65 63 74 00 21 00 02 00 03 00 00 00 00 00 bject.!......... 方法表 方法表同样分为两个部分：methods_count和methods\nmethods_count 方法计数器，共占用两个字节，从0开始，表示当前class文件定义的方法数量，不包含继承的部分。\n上文的例子中表示的位置：\n00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 00000070 62 6A 65 63 74 00 21 00 02 00 03 00 00 00 00 00 bject.!......... 00000080 01 00 01 00 04 00 05 00 01 00 06 00 00 00 1D 00 ................ 只有一个方法。\nmethods 方法数组，长度不定，每个元素均为method_info。\nmethod_info数据结构：\nmethod_info { u2 access_flags; u2 name_index; u2 descriptor_index; u2 attributes_count; attribute_info attributes[attributes_count]; } 和字段表元素结构类似，name_index和descriptor_index均是constant_pool中的一个CONSTANT_Utf8_info常量的索引。\n以上文的例子数据来看：\n00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 00000080 01 00 01 00 04 00 05 00 01 00 06 00 00 00 1D 00 ................ 这里共8个字节，不包含attributes，相关常量查看上文:\n 00 01: access_flags，访问标志：ACC_PUBLIC 00 04: name_index，方法名，常量表里的  00 05: descriptor_index，方法描述，常量表里的 ()V 00 01: attributes_count，方法属性个数，1个  方法的属性同类属性一起。\n属性表 属性表同样也是两个部分组成：attributes_count和attributes\nattributes_count 属性计数器，共占2个字节，表示attributes数组元素的个数。\nattributes 属性数组，大小不定，长度为attributes_count，每个元素的结构都是attribute_info，字段、方法、class文件都会用到。\nattribute_info数据结构：\nattribute_info { u2 attribute_name_index; u4 attribute_length; u1 info[attribute_length]; } 其中attribute_name_index表示的是属性名，其值为常量池constant_pool中的一个CONSTANT_Utf8_info常量的索引，属性内容长度用了4个字节表示。\nclass文件五个非常重要的属性：\n ConstantValue Code StackMapTable Exceptions BootstrapMethods  详细属性可在官网了解，这里只简单说明下\nCode是method_info的一个属性，它包含方法体内容，其结构为\nCode_attribute { u2 attribute_name_index; u4 attribute_length; u2 max_stack; u2 max_locals; u4 code_length; u1 code[code_length]; u2 exception_table_length; { u2 start_pc; u2 end_pc; u2 handler_pc; u2 catch_type; } exception_table[exception_table_length]; u2 attributes_count; attribute_info attributes[attributes_count]; } 方法体为code_length+code[code_length]，其他不再细说。\n根据上文仅有的方法来看，它只有一个属性，也就是\n00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 00000080 01 00 01 00 04 00 05 00 01 00 06 00 00 00 1D 00 ................ 00000090 01 00 01 00 00 00 05 2A B7 00 01 B1 00 00 00 01 .......*·..±.... 000000A0 00 07 00 00 00 06 00 01 00 00 00 01 00 01 00 08 ................ 000000B0 00 00 00 02 00 09 ...... 常量表见上文\n 00 06: 属性名索引，值为Code 00 00 00 00 1D: 属性内容长度，值为30个字节  内容根据Code_attribute的数据结构解析\nmax_stack：00 01\nmax_locals：00 01\ncode_length：00 00 00 05\ncode[code_length]：2A B7 00 01 B1\nexception_table_length：00 00\nexception_table： 无\nattributes_count：00 01\nattributes：00 07 00 00 00 06 00 01 00 00 00 01 00\nCode中的attributes还有一个00 07表示的一个LineNumberTable，这里不做说明\n剩下的字节也就是class文件的属性：\n00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 000000A0 00 07 00 00 00 06 00 01 00 00 00 01 00 01 00 08 ................ 000000B0 00 00 00 02 00 09 ...... 这里表示的是SourceFile属性，其值为Demo.java\n思考  Q：导入的静态方法是怎么表示的？\n如果代码里没有用到，编译后会被优化。import的类和方法都会放入constant_pool中作为常量。  延伸  Class 文件基本组织结构 Java class file - Wiki The class File Format    一般描述为固定不变的值 ↩︎\n  ","wordCount":"5528","inLanguage":"zh","datePublished":"2021-06-08T19:52:10+08:00","dateModified":"2021-06-08T19:52:10+08:00","author":{"@type":"Person","name":"DnF"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zone.dnfn.tech/post/20210608875210/"},"publisher":{"@type":"Organization","name":"DnF's Zone","logo":{"@type":"ImageObject","url":"https://zone.dnfn.tech/favicon.svg"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://zone.dnfn.tech accesskey=h title="DnF's Zone (Alt + H)">DnF's Zone</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://zone.dnfn.tech/search title=搜索><span>搜索</span></a></li><li><a href=https://zone.dnfn.tech/categories title=分类><span>分类</span></a></li><li><a href=https://zone.dnfn.tech/tags title=标签><span>标签</span></a></li><li><a href=https://zone.dnfn.tech/series title=系列><span>系列</span></a></li><li><a href=https://zone.dnfn.tech/archive title=归档><span>归档</span></a></li><li><a href=https://zone.dnfn.tech/about title=码夫><span>码夫</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://zone.dnfn.tech>Home</a>&nbsp;»&nbsp;<a href=https://zone.dnfn.tech/post/>Posts</a></div><h1 class=post-title>Java Class 文件解析</h1><div class=post-meta>2021-06-08&nbsp;·&nbsp;DnF</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>目录</div></summary><div class=inner><ul><li><a href=#%e7%ae%80%e4%bb%8b----omit-in-toc--- aria-label="简介 ">简介</a></li><li><a href=#%e7%8e%af%e5%a2%83 aria-label=环境>环境</a></li><li><a href=#class%e6%96%87%e4%bb%b6%e5%86%85%e5%ae%b9 aria-label=Class文件内容>Class文件内容</a></li><li><a href=#class%e6%96%87%e4%bb%b6%e7%bb%93%e6%9e%84 aria-label=Class文件结构>Class文件结构</a><ul><li><a href=#magic_number aria-label=magic_number>magic_number</a></li><li><a href=#minor_versionmajor_version aria-label=minor_version,major_version>minor_version,major_version</a></li><li><a href=#%e5%b8%b8%e9%87%8f%e6%b1%a0 aria-label=常量池>常量池</a><ul><li><a href=#constant_pool_count aria-label=constant_pool_count>constant_pool_count</a></li><li><a href=#constant_pool aria-label=constant_pool>constant_pool</a></li></ul></li><li><a href=#access_flags aria-label=access_flags>access_flags</a></li><li><a href=#this_class aria-label=this_class>this_class</a></li><li><a href=#super_class aria-label=super_class>super_class</a></li><li><a href=#%e6%8e%a5%e5%8f%a3%e8%a1%a8 aria-label=接口表>接口表</a><ul><li><a href=#interfaces_count aria-label=interfaces_count>interfaces_count</a></li><li><a href=#interfaces aria-label=interfaces>interfaces</a></li></ul></li><li><a href=#%e5%ad%97%e6%ae%b5%e8%a1%a8 aria-label=字段表>字段表</a><ul><li><a href=#fields_count aria-label=fields_count>fields_count</a></li><li><a href=#fields aria-label=fields>fields</a></li></ul></li><li><a href=#%e6%96%b9%e6%b3%95%e8%a1%a8 aria-label=方法表>方法表</a><ul><li><a href=#methods_count aria-label=methods_count>methods_count</a></li><li><a href=#methods aria-label=methods>methods</a></li></ul></li><li><a href=#%e5%b1%9e%e6%80%a7%e8%a1%a8 aria-label=属性表>属性表</a><ul><li><a href=#attributes_count aria-label=attributes_count>attributes_count</a></li><li><a href=#attributes aria-label=attributes>attributes</a></li></ul></li></ul></li><li><a href=#%e6%80%9d%e8%80%83 aria-label=思考>思考</a></li><li><a href=#%e5%bb%b6%e4%bc%b8 aria-label=延伸>延伸</a></li></ul></div></details></div><div class=post-content><h2 id=简介----omit-in-toc--->简介 <a hidden class=anchor aria-hidden=true href=#简介----omit-in-toc--->#</a></h2><p><code>.java</code> 文件编译后的 <code>.class</code> 文件内容究竟是怎样的？<code>JVM</code> 又是如果识别并加载 <code>.class</code> 文件的。</p><h2 id=环境>环境<a hidden class=anchor aria-hidden=true href=#环境>#</a></h2><p>Win10、Nixos<br>JDK1.8</p><h2 id=class文件内容>Class文件内容<a hidden class=anchor aria-hidden=true href=#class文件内容>#</a></h2><p>windows 下用 <code>Powershell</code> 查看字节码内容(十六进制)</p><div class=highlight><pre class=chroma><code class=language-ps1 data-lang=ps1><span class=n>PS</span><span class=p>&gt;</span> <span class=nb>cat </span><span class=n>Demo</span><span class=p>.</span><span class=n>java</span><span class=p>;</span>
<span class=n>public</span> <span class=n>class</span> <span class=n>Demo</span><span class=p>{}</span>

<span class=n>PS</span><span class=p>&gt;</span> <span class=n>javac</span><span class=p>.</span><span class=n>exe</span> <span class=n>Demo</span><span class=p>.</span><span class=n>java</span><span class=p>;</span> <span class=nb>Format-Hex</span> <span class=n>Demo</span><span class=p>.</span><span class=n>class</span>

           <span class=n>Path</span><span class=err>:</span> <span class=n>D:</span><span class=p>\</span><span class=n>tmp</span><span class=p>\</span><span class=n>java</span><span class=p>\</span><span class=n>Demo</span><span class=p>.</span><span class=n>class</span>

           <span class=n>00</span> <span class=n>01</span> <span class=n>02</span> <span class=n>03</span> <span class=n>04</span> <span class=n>05</span> <span class=n>06</span> <span class=n>07</span> <span class=n>08</span> <span class=n>09</span> <span class=n>0A</span> <span class=n>0B</span> <span class=n>0C</span> <span class=n>0D</span> <span class=n>0E</span> <span class=n>0F</span>

<span class=n>00000000</span>   <span class=n>CA</span> <span class=n>FE</span> <span class=n>BA</span> <span class=n>BE</span> <span class=n>00</span> <span class=n>00</span> <span class=n>00</span> <span class=n>34</span> <span class=n>00</span> <span class=n>0D</span> <span class=n>0A</span> <span class=n>00</span> <span class=n>03</span> <span class=n>00</span> <span class=n>0A</span> <span class=n>07</span>  <span class=n>Êþº</span><span class=err>¾</span><span class=p>...</span><span class=n>4</span><span class=p>........</span>
<span class=n>00000010</span>   <span class=n>00</span> <span class=n>0B</span> <span class=n>07</span> <span class=n>00</span> <span class=n>0C</span> <span class=n>01</span> <span class=n>00</span> <span class=n>06</span> <span class=n>3C</span> <span class=n>69</span> <span class=n>6E</span> <span class=n>69</span> <span class=n>74</span> <span class=n>3E</span> <span class=n>01</span> <span class=n>00</span>  <span class=p>........&lt;</span><span class=n>init</span><span class=p>&gt;..</span>
<span class=n>00000020</span>   <span class=n>03</span> <span class=n>28</span> <span class=n>29</span> <span class=n>56</span> <span class=n>01</span> <span class=n>00</span> <span class=n>04</span> <span class=n>43</span> <span class=n>6F</span> <span class=n>64</span> <span class=n>65</span> <span class=n>01</span> <span class=n>00</span> <span class=n>0F</span> <span class=n>4C</span> <span class=n>69</span>  <span class=p>.()</span><span class=n>V</span><span class=p>...</span><span class=n>Code</span><span class=p>...</span><span class=n>Li</span>
<span class=n>00000030</span>   <span class=n>6E</span> <span class=n>65</span> <span class=n>4E</span> <span class=n>75</span> <span class=n>6D</span> <span class=n>62</span> <span class=n>65</span> <span class=n>72</span> <span class=n>54</span> <span class=n>61</span> <span class=n>62</span> <span class=n>6C</span> <span class=n>65</span> <span class=n>01</span> <span class=n>00</span> <span class=n>0A</span>  <span class=n>neNumberTable</span><span class=p>...</span>
<span class=n>00000040</span>   <span class=n>53</span> <span class=n>6F</span> <span class=n>75</span> <span class=n>72</span> <span class=n>63</span> <span class=n>65</span> <span class=n>46</span> <span class=n>69</span> <span class=n>6C</span> <span class=n>65</span> <span class=n>01</span> <span class=n>00</span> <span class=n>09</span> <span class=n>44</span> <span class=n>65</span> <span class=n>6D</span>  <span class=n>SourceFile</span><span class=p>...</span><span class=n>Dem</span>
<span class=n>00000050</span>   <span class=n>6F</span> <span class=n>2E</span> <span class=n>6A</span> <span class=n>61</span> <span class=n>76</span> <span class=n>61</span> <span class=n>0C</span> <span class=n>00</span> <span class=n>04</span> <span class=n>00</span> <span class=n>05</span> <span class=n>01</span> <span class=n>00</span> <span class=n>04</span> <span class=n>44</span> <span class=n>65</span>  <span class=n>o</span><span class=p>.</span><span class=n>java</span><span class=p>........</span><span class=n>De</span>
<span class=n>00000060</span>   <span class=n>6D</span> <span class=n>6F</span> <span class=n>01</span> <span class=n>00</span> <span class=n>10</span> <span class=n>6A</span> <span class=n>61</span> <span class=n>76</span> <span class=n>61</span> <span class=n>2F</span> <span class=n>6C</span> <span class=n>61</span> <span class=n>6E</span> <span class=n>67</span> <span class=n>2F</span> <span class=n>4F</span>  <span class=n>mo</span><span class=p>...</span><span class=n>java</span><span class=p>/</span><span class=n>lang</span><span class=p>/</span><span class=n>O</span>
<span class=n>00000070</span>   <span class=n>62</span> <span class=n>6A</span> <span class=n>65</span> <span class=n>63</span> <span class=n>74</span> <span class=n>00</span> <span class=n>21</span> <span class=n>00</span> <span class=n>02</span> <span class=n>00</span> <span class=n>03</span> <span class=n>00</span> <span class=n>00</span> <span class=n>00</span> <span class=n>00</span> <span class=n>00</span>  <span class=n>bject</span><span class=p>.!.........</span>
<span class=n>00000080</span>   <span class=n>01</span> <span class=n>00</span> <span class=n>01</span> <span class=n>00</span> <span class=n>04</span> <span class=n>00</span> <span class=n>05</span> <span class=n>00</span> <span class=n>01</span> <span class=n>00</span> <span class=n>06</span> <span class=n>00</span> <span class=n>00</span> <span class=n>00</span> <span class=n>1D</span> <span class=n>00</span>  <span class=p>................</span>
<span class=n>00000090</span>   <span class=n>01</span> <span class=n>00</span> <span class=n>01</span> <span class=n>00</span> <span class=n>00</span> <span class=n>00</span> <span class=n>05</span> <span class=n>2A</span> <span class=n>B7</span> <span class=n>00</span> <span class=n>01</span> <span class=n>B1</span> <span class=n>00</span> <span class=n>00</span> <span class=n>00</span> <span class=n>01</span>  <span class=p>.......*</span><span class=err>·</span><span class=p>..</span><span class=err>±</span><span class=p>....</span>
<span class=n>000000A0</span>   <span class=n>00</span> <span class=n>07</span> <span class=n>00</span> <span class=n>00</span> <span class=n>00</span> <span class=n>06</span> <span class=n>00</span> <span class=n>01</span> <span class=n>00</span> <span class=n>00</span> <span class=n>00</span> <span class=n>01</span> <span class=n>00</span> <span class=n>01</span> <span class=n>00</span> <span class=n>08</span>  <span class=p>................</span>
<span class=n>000000B0</span>   <span class=n>00</span> <span class=n>00</span> <span class=n>00</span> <span class=n>02</span> <span class=n>00</span> <span class=n>09</span>                                <span class=p>......</span>
</code></pre></div><p>Linux 下命令行查看</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ cat IDemo.java
public interface IDemo<span class=o>{}</span>

$ javac IDemo.java <span class=p>;</span> hexdump IDemo.class
<span class=m>0000000</span> feca beba <span class=m>0000</span> <span class=m>3400</span> <span class=m>0700</span> <span class=m>0007</span> <span class=m>0705</span> <span class=m>0600</span>
<span class=m>0000010</span> <span class=m>0001</span> 530a 756f <span class=m>6372</span> <span class=m>4665</span> 6c69 <span class=m>0165</span> 0a00
<span class=m>0000020</span> <span class=m>4449</span> 6d65 2e6f 616a <span class=m>6176</span> <span class=m>0001</span> <span class=m>4905</span> <span class=m>6544</span>
<span class=m>0000030</span> 6f6d <span class=m>0001</span> 6a10 <span class=m>7661</span> 2f61 616c 676e 4f2f
<span class=m>0000040</span> 6a62 <span class=m>6365</span> <span class=m>0674</span> <span class=m>0001</span> <span class=m>0001</span> <span class=m>0002</span> <span class=m>0000</span> <span class=m>0000</span>
<span class=m>0000050</span> <span class=m>0000</span> <span class=m>0001</span> <span class=m>0003</span> <span class=m>0000</span> <span class=m>0002</span> <span class=m>0004</span>
000005b
</code></pre></div><p>这里大小端是相反的。</p><h2 id=class文件结构>Class文件结构<a hidden class=anchor aria-hidden=true href=#class文件结构>#</a></h2><p>一个完整的 <code>class</code> 文件大致可分为10个部分</p><ol><li>魔数</li><li>版本号</li><li>常量池<br>3.1 常量池计数器<br>3.2 常量池数据区</li><li>访问标志</li><li>类索引</li><li>父类索引</li><li>接口<br>7.1 接口计数器<br>7.2 接口信息区</li><li>字段<br>8.1 字段计数器<br>8.2 字段信息区</li><li>方法<br>9.1 方法计数器<br>9.2 方法信息区</li><li>属性<br>10.1 属性计数器<br>10.2 属性信息区</li></ol><p>关于<code>class</code> 文件的基本数据结构在 <a href=https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html title="JDK8虚拟机规范 - The class File Format">The Java Virtual Machine Specification (Second ed.)</a>文档有详细的说明，如下:</p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=k>struct</span> <span class=n>Class_File_Format</span> <span class=p>{</span>
   <span class=n>u4</span> <span class=n>magic_number</span><span class=p>;</span>

   <span class=n>u2</span> <span class=n>minor_version</span><span class=p>;</span>
   <span class=n>u2</span> <span class=n>major_version</span><span class=p>;</span>

   <span class=n>u2</span> <span class=n>constant_pool_count</span><span class=p>;</span>
   <span class=n>cp_info</span> <span class=n>constant_pool</span><span class=p>[</span><span class=n>constant_pool_count</span> <span class=o>-</span> <span class=mi>1</span><span class=p>];</span>

   <span class=n>u2</span> <span class=n>access_flags</span><span class=p>;</span>
   <span class=n>u2</span> <span class=n>this_class</span><span class=p>;</span>
   <span class=n>u2</span> <span class=n>super_class</span><span class=p>;</span>

   <span class=n>u2</span> <span class=n>interfaces_count</span><span class=p>;</span>
   <span class=n>u2</span> <span class=n>interfaces</span><span class=p>[</span><span class=n>interfaces_count</span><span class=p>];</span>

   <span class=n>u2</span> <span class=n>fields_count</span><span class=p>;</span>
   <span class=n>field_info</span> <span class=n>fields</span><span class=p>[</span><span class=n>fields_count</span><span class=p>];</span>

   <span class=n>u2</span> <span class=n>methods_count</span><span class=p>;</span>
   <span class=n>method_info</span> <span class=n>methods</span><span class=p>[</span><span class=n>methods_count</span><span class=p>];</span>

   <span class=n>u2</span> <span class=n>attributes_count</span><span class=p>;</span>
   <span class=n>attribute_info</span> <span class=n>attributes</span><span class=p>[</span><span class=n>attributes_count</span><span class=p>];</span>
<span class=p>}</span>
</code></pre></div><p>u4: 指4个字节的无符号整型<br>u2: 指2个字节的无符号整型<br>而<code>cp_info</code>、<code>field_info</code>、<code>method_info</code>、<code>attribute_info</code> 表示相关数据结构，长度均不定可变</p><h3 id=magic_number>magic_number<a hidden class=anchor aria-hidden=true href=#magic_number>#</a></h3><p>魔数(<code>magic_number</code>)是指某一文件格式下前几个固定字节值，一般用于识别文件格式，<code>class</code>文件的魔数固定为前4个字节，即：<code>CA FE BA BE</code>。<br>至于它的来源和背后的故事可以看看 <a href=https://en.wikipedia.org/wiki/Java_class_file title="Java class file - Wiki">Wiki - Java class file</a> 下的 <code>Magic Number</code></p><h3 id=minor_versionmajor_version>minor_version,major_version<a hidden class=anchor aria-hidden=true href=#minor_versionmajor_version>#</a></h3><p><code>minor_version</code>,<code>major_version</code>统称版本号，共占用4个字节，各分为2个字节的次版本号(<code>minor_version</code>)占第5、6字节位以及占第7、8字节位的主版本号(<code>major_version</code>)。版本号的作用为标识 <code>class</code> 文件是在具体哪个版本的 <code>JVM</code> 下生成的，让运行时环境的<code>JVM</code>确认是否可以加载此版本的<code>class</code>文件。</p><p>以下常见主版本号(<code>major_version</code>)</p><blockquote><p>Java SE 17 = 61 (0x3D hex),<br>Java SE 16 = 60 (0x3C hex),<br>Java SE 15 = 59 (0x3B hex),<br>Java SE 14 = 58 (0x3A hex),<br>Java SE 13 = 57 (0x39 hex),<br>Java SE 12 = 56 (0x38 hex),<br>Java SE 11 = 55 (0x37 hex),<br>Java SE 10 = 54 (0x36 hex),<br>Java SE 9 = 53 (0x35 hex),<br>Java SE 8 = 52 (0x34 hex),<br>Java SE 7 = 51 (0x33 hex),<br>Java SE 6.0 = 50 (0x32 hex),<br>Java SE 5.0 = 49 (0x31 hex),<br>JDK 1.4 = 48 (0x30 hex),<br>JDK 1.3 = 47 (0x2F hex),<br>JDK 1.2 = 46 (0x2E hex),<br>JDK 1.1 = 45 (0x2D hex).</p></blockquote><h3 id=常量池>常量池<a hidden class=anchor aria-hidden=true href=#常量池>#</a></h3><p>常量池分为两个数据字段：<code>constant_pool_count</code>(计数器)+<code>constant_pool</code>(数据结构数组)。存储了整个<code>class</code>文件下的字面量信息<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>，包括：各类型的数字、字符串、类引用、方法引用、字段引用和方法句柄等其他常量。</p><h4 id=constant_pool_count>constant_pool_count<a hidden class=anchor aria-hidden=true href=#constant_pool_count>#</a></h4><p>常量池计数器（实际并不是数量），它的值：<code>constant_pool_count</code> = <code>constant_pool</code>实体的数量 + 1，这一点与其他的池不同，<code>constant_pool</code>的索引在(0,<code>constant_pool_count</code>)之间（不包含）。总共占2个无符号字节。数值0表示为未引用任何对象。</p><p>以前面win下的例子来说：</p><div class=highlight><pre class=chroma><code class=language-cmd data-lang=cmd>           00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F

00000000   CA FE BA BE 00 00 00 34 <span id=dye-0 idx=0 style=color:#f03>00 0D</span> 0A 00 03 00 0A 07  Êþº¾...4........
</code></pre></div><p><code>00 0D</code>也就是13，但常量池数量需要减1，所以是12。</p><h4 id=constant_pool>constant_pool<a hidden class=anchor aria-hidden=true href=#constant_pool>#</a></h4><p><code>constant_pool_count</code>只是常量池的计数器，实际数据在<code>constant_pool</code>数组中。<code>constant_pool</code>也就是实际意义上的常量池，长度不定。数组中每一个元素数据结构为：</p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=n>cp_info</span> <span class=p>{</span>
    <span class=n>u1</span> <span class=n>tag</span><span class=p>;</span>
    <span class=n>u1</span> <span class=n>info</span><span class=p>[];</span>
<span class=p>}</span>
</code></pre></div><ul><li>tag：常量的类型</li><li>info：常量信息</li></ul><p>常量信息<code>info</code>是一个不确定数组，不同的<code>tag</code>也就是常量类型，<code>info</code>数组长度是不一样，每个常量类型的<code>info</code>都是固定的或可计算的，而对于字符串等不定长的结构，通常都是采取分为两个字段表示（实际上池也是）：一个长度，一个数组。</p><p>相关的<code>tag</code>类型:</p><p><a href=https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html#jvms-4.4-140 title="Table 4.4-A. Constant pool tags"><img loading=lazy src=https://oss.dnfn.tech:1024/bedroom/2021/8/14/20210814111148.png#center alt="Table 4.4-B. Constant pool tags (by tag)" title="Table 4.4-A. Constant pool tags"></a></p><p>需要注意的几个结构：</p><p>因为在<code>class</code>文件中，大多数信息最终都会用字符串内容表示，所以字符串内容无疑是最基本的结构之一。</p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=n>CONSTANT_Utf8_info</span> <span class=p>{</span>
    <span class=n>u1</span> <span class=n>tag</span><span class=p>;</span>
    <span class=n>u2</span> <span class=n>length</span><span class=p>;</span>
    <span class=n>u1</span> <span class=n>bytes</span><span class=p>[</span><span class=n>length</span><span class=p>];</span>
<span class=p>}</span>
</code></pre></div><p><code>CONSTANT_Utf8_info</code> 也就是我们常说的字符串常量（utf8编码过后的内容），它在<code>tag</code>之后的两个字节为无符号数值，它表示了这个字符串的UTF-8编码后的字节数组长度，即<code>bytes</code>的大小。这里不深入<code>bytes</code>存储的具体内容和方式，详细可查看<a href=https://www.unicode.org/versions/Unicode6.0.0/ch03.pdf#G31703 title="Section 3.9 Unicode Encoding Forms of The Unicode Standard">原文档</a>。</p><p>然后是<code>CONSTANT_String_info</code>：</p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=n>CONSTANT_String_info</span> <span class=p>{</span>
    <span class=n>u1</span> <span class=n>tag</span><span class=p>;</span>
    <span class=n>u2</span> <span class=n>string_index</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><p><code>CONSTANT_Utf8_info</code>用来表示常量字符串的内容，而<code>CONSTANT_String_info</code>则表示常量字符串对象，即为产生的<code>Object</code>。对象的实际内容通过<code>string_index</code>指向实际的<code>CONSTANT_Utf8_info</code>。</p><p>常量池中大多数都是依赖一个<code>index</code>指向实际的<code>CONSTANT_Utf8_info</code>来表示（数值直接通过字节表示）。</p><p>例如，类：</p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=n>CONSTANT_Class_info</span> <span class=p>{</span>
    <span class=n>u1</span> <span class=n>tag</span><span class=p>;</span>
    <span class=n>u2</span> <span class=n>name_index</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><p><code>name_index</code>实际就是一个<code>CONSTANT_Utf8_info</code>的索引。</p><p>再比如，方法、字段等：</p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=n>CONSTANT_Fieldref_info</span> <span class=p>{</span>
    <span class=n>u1</span> <span class=n>tag</span><span class=p>;</span>
    <span class=n>u2</span> <span class=n>class_index</span><span class=p>;</span>
    <span class=n>u2</span> <span class=n>name_and_type_index</span><span class=p>;</span>
<span class=p>}</span>

<span class=n>CONSTANT_Methodref_info</span> <span class=p>{</span>
    <span class=n>u1</span> <span class=n>tag</span><span class=p>;</span>
    <span class=n>u2</span> <span class=n>class_index</span><span class=p>;</span>
    <span class=n>u2</span> <span class=n>name_and_type_index</span><span class=p>;</span>
<span class=p>}</span>

<span class=n>CONSTANT_InterfaceMethodref_info</span> <span class=p>{</span>
    <span class=n>u1</span> <span class=n>tag</span><span class=p>;</span>
    <span class=n>u2</span> <span class=n>class_index</span><span class=p>;</span>
    <span class=n>u2</span> <span class=n>name_and_type_index</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><p>这里的<code>class_index</code>指的是<code>constant_pool</code>中一个具体的<code>CONSTANT_Class_info</code>的索引，而<code>name_and_type_index</code>指的其中具体某一个<code>CONSTANT_NameAndType_info</code>，其结构如下：</p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=n>CONSTANT_NameAndType_info</span> <span class=p>{</span>
    <span class=n>u1</span> <span class=n>tag</span><span class=p>;</span>
    <span class=n>u2</span> <span class=n>name_index</span><span class=p>;</span>
    <span class=n>u2</span> <span class=n>descriptor_index</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><p>它包含的<code>name_index</code>和<code>descriptor_index</code>是两个<code>CONSTANT_Utf8_info</code>在常量池的索引。</p><p>以前面win下的例子来看：</p><div class=highlight><pre class=chroma><code class=language-ps data-lang=ps>           <span class=mf>00</span> <span class=mf>01</span> <span class=mf>02</span> <span class=mf>03</span> <span class=mf>04</span> <span class=mf>05</span> <span class=mf>06</span> <span class=mf>07</span> <span class=mf>08</span> <span class=mf>09</span> <span class=nf>0A</span> <span class=nf>0B</span> <span class=nf>0C</span> <span class=nf>0D</span> <span class=nf>0E</span> <span class=nf>0F</span>

<span class=mf>00000000</span>   <span class=nf>CA</span> <span class=nf>FE</span> <span class=nf>BA</span> <span class=nf>BE</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>34</span> <span class=mf>00</span> <span class=nf>0D</span> <span class=nf><span id=dye-1 idx=1 style=color:#ff0>0A 00 03 00 0A</span></span> <span class=nf><span id=dye-2 idx=2 style=color:#06c>07</span></span>  <span class=nf>Êþº¾...4........</span>
<span class=mf>00000010</span>   <span class=nf><span id=dye-3 idx=3 style=color:#06c>00 0B</span></span> <span class=nf><span id=dye-4 idx=3 style=color:#f90>07 00 0C</span></span> <span class=nf><span id=dye-5 idx=4 style=color:#ee2>01 00 06 3C 69 6E 69 74 3E</span></span> <span class=nf><span id=dye-6 idx=5 style=color:#0f4>01 00</span></span>  <span class=nf>........</span><span class=p>&lt;</span><span class=nf>init</span><span class=p>&gt;</span><span class=nf>..</span>
<span class=mf>00000020</span>   <span class=nf><span id=dye-7 idx=6 style=color:#0f4>03 28 29 56</span></span> <span class=nf><span id=dye-8 idx=6 style=color:#4ff>01 00 04 43 6F 64 65</span></span> <span class=nf><span id=dye-9 idx=7 style=color:#f03>01 00 0F 4C 69</span></span>  <span class=nf>.</span><span class=s>()</span><span class=nf>V...Code...Li</span>
<span class=mf>00000030</span>   <span class=nf><span id=dye-10 idx=8 style=color:#f03>6E 65 4E 75 6D 62 65 72 54 61 62 6C 65</span></span> <span class=nf><span id=dye-11 idx=8 style=color:#ff0>01 00 0A</span></span>  <span class=nf>neNumberTable...</span>
<span class=mf>00000040</span>   <span class=nf><span id=dye-12 idx=9 style=color:#ff0>53 6F 75 72 63 65 46 69 6C 65</span></span> <span class=nf><span id=dye-13 idx=9 style=color:#06c>01 00 09 44 65 6D</span></span>  <span class=nf>SourceFile...Dem</span>
<span class=mf>00000050</span>   <span class=nf><span id=dye-14 idx=10 style=color:#06c>6F 2E 6A 61 76 61</span></span> <span class=nf><span id=dye-15 idx=10 style=color:#f90>0C 00 04 00 05</span></span> <span class=nf><span id=dye-16 idx=11 style=color:#ee2>01 00 04 44 65</span></span>  <span class=nf>o.java........De</span>
<span class=mf>00000060</span>   <span class=nf><span id=dye-17 idx=12 style=color:#ee2>6D 6F</span></span> <span class=nf><span id=dye-18 idx=12 style=color:#0f4>01 00 10 6A 61 76 61 2F 6C 61 6E 67 2F 4F</span></span>  <span class=nf>mo...java</span><span class=nv>/lang/O</span>
<span class=mf>00000070</span>   <span class=nf><span id=dye-19 idx=13 style=color:#0f4>62 6A 65 63 74</span></span> <span class=mf>00</span> <span class=mf>21</span> <span class=mf>00</span> <span class=mf>02</span> <span class=mf>00</span> <span class=mf>03</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span>  <span class=nf>bject.!.........</span>
</code></pre></div><p>共计12个常量，简单说明几个：</p><p>第1个：<code>0A 00 03 00 0A</code>，<code>tag</code>：<code>0A</code>(<code>CONSTANT_Methodref_info</code>)，<code>info[4]</code>：<code>00 03 00 0A</code>。</p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=n>CONSTANT_Methodref_info</span> <span class=p>{</span>
    <span class=n>u1</span> <span class=n>tag</span><span class=p>;</span> <span class=c1>// `0A`
</span><span class=c1></span>    <span class=n>u2</span> <span class=n>class_index</span><span class=p>;</span> <span class=c1>// `00 03`
</span><span class=c1></span>    <span class=n>u2</span> <span class=n>name_and_type_index</span><span class=p>;</span> <span class=c1>// `00 0A`
</span><span class=c1></span><span class=p>}</span>
</code></pre></div><p>第3个：<code>07 00 0C</code></p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=n>CONSTANT_Class_info</span> <span class=p>{</span>
    <span class=n>u1</span> <span class=n>tag</span><span class=p>;</span> <span class=c1>// 07
</span><span class=c1></span>    <span class=n>u2</span> <span class=n>name_index</span><span class=p>;</span> <span class=c1>// 00 0C
</span><span class=c1></span><span class=p>}</span>
</code></pre></div><p>第10个：<code>0C 00 04 00 05</code></p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=n>CONSTANT_NameAndType_info</span> <span class=p>{</span>
    <span class=n>u1</span> <span class=n>tag</span><span class=p>;</span> <span class=c1>// 0C
</span><span class=c1></span>    <span class=n>u2</span> <span class=n>name_index</span><span class=p>;</span> <span class=c1>// 00 04
</span><span class=c1></span>    <span class=n>u2</span> <span class=n>descriptor_index</span><span class=p>;</span> <span class=c1>//00 05
</span><span class=c1></span><span class=p>}</span>
</code></pre></div><p>第12个：<code>01 00 10 6A 61 76 61 2F 6C 61 6E 67 2F 4F 62 6A 65 63 74</code></p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=n>CONSTANT_Utf8_info</span> <span class=p>{</span>
    <span class=n>u1</span> <span class=n>tag</span><span class=p>;</span> <span class=c1>// 01
</span><span class=c1></span>    <span class=n>u2</span> <span class=n>length</span><span class=p>;</span> <span class=c1>// 00 10
</span><span class=c1></span>    <span class=n>u1</span> <span class=n>bytes</span><span class=p>[</span><span class=n>length</span><span class=p>];</span> <span class=c1>// 6A 61 76 61 2F 6C 61 6E 67 2Fj 4F 62 6A 65 63 74
</span><span class=c1></span><span class=p>}</span>
</code></pre></div><p>这里直接通过 <code>javap</code> 查看<code>class</code>文件的编译字节信息</p><div class=highlight id=M1><pre class=chroma><code class=language-ps data-lang=ps><span class=nf>PS</span><span class=p>&gt;</span> <span class=nf>javap</span> <span class=nf>-v</span> <span class=nf>Demo.class</span>
<span class=nf>Classfile</span> <span class=nf>D:\tmp\java\Demo.class</span>
  <span class=nf>Last</span> <span class=nf>modified</span> <span class=nf>2021-6-19;</span> <span class=nf>size</span> <span class=mf>182</span> <span class=nf>bytes</span>
  <span class=nf>MD5</span> <span class=nf>checksum</span> <span class=nf>626255e824a12d768af074fcb588b1d3</span>
  <span class=nf>Compiled</span> <span class=nf>from</span> <span class=nf>&#34;Demo.java&#34;</span>
<span class=nf>public</span> <span class=nf>class</span> <span class=nf>Demo</span>
  <span class=nf>minor</span> <span class=nf>version:</span> <span class=mf>0</span>
  <span class=nf>major</span> <span class=nf>version:</span> <span class=mf>52</span>
  <span class=nf>flags:</span> <span class=nf>ACC_PUBLIC,</span> <span class=nf>ACC_SUPER</span>
<span class=nf>Constant</span> <span class=nf>pool:</span>
   <span class=nf>#1</span> <span class=nf>=</span> <span class=nf>Methodref</span>          <span class=nf>#3.#10</span>         <span class=err>//</span> <span class=nf>java</span><span class=nv>/lang/Object.&#34;</span><span class=p>&lt;</span><span class=nf>init</span><span class=p>&gt;</span><span class=nf>&#34;:</span><span class=s>()</span><span class=nf>V</span>
   <span class=nf>#2</span> <span class=nf>=</span> <span class=nf>Class</span>              <span class=nf>#11</span>            <span class=err>//</span> <span class=nf>Demo</span>
   <span class=nf>#3</span> <span class=nf>=</span> <span class=nf>Class</span>              <span class=nf>#12</span>            <span class=err>//</span> <span class=nf>java</span><span class=nv>/lang/Object</span>
   <span class=nf>#4</span> <span class=nf>=</span> <span class=nf>Utf8</span>               <span class=p>&lt;</span><span class=nf>init</span><span class=p>&gt;</span>
   <span class=nf>#5</span> <span class=nf>=</span> <span class=nf>Utf8</span>               <span class=s>()</span><span class=nf>V</span>
   <span class=nf>#6</span> <span class=nf>=</span> <span class=nf>Utf8</span>               <span class=nf>Code</span>
   <span class=nf>#7</span> <span class=nf>=</span> <span class=nf>Utf8</span>               <span class=nf>LineNumberTable</span>
   <span class=nf>#8</span> <span class=nf>=</span> <span class=nf>Utf8</span>               <span class=nf>SourceFile</span>
   <span class=nf>#9</span> <span class=nf>=</span> <span class=nf>Utf8</span>               <span class=nf>Demo.java</span>
  <span class=nf>#10</span> <span class=nf>=</span> <span class=nf>NameAndType</span>        <span class=nf>#4:#5</span>          <span class=err>//</span> <span class=nf>&#34;</span><span class=p>&lt;</span><span class=nf>init</span><span class=p>&gt;</span><span class=nf>&#34;:</span><span class=s>()</span><span class=nf>V</span>
  <span class=nf>#11</span> <span class=nf>=</span> <span class=nf>Utf8</span>               <span class=nf>Demo</span>
  <span class=nf>#12</span> <span class=nf>=</span> <span class=nf>Utf8</span>               <span class=nf>java</span><span class=nv>/lang/Object</span>
<span class=p>{</span>
  <span class=nf>public</span> <span class=nf>Demo</span><span class=s>()</span><span class=nf>;</span>
    <span class=nf>descriptor:</span> <span class=s>()</span><span class=nf>V</span>
    <span class=nf>flags:</span> <span class=nf>ACC_PUBLIC</span>
    <span class=nf>Code:</span>
      <span class=nf>stack=1,</span> <span class=nf>locals=1,</span> <span class=nf>args_size=1</span>
         <span class=nf>0:</span> <span class=nf>aload_0</span>
         <span class=nf>1:</span> <span class=nf>invokespecial</span> <span class=nf>#1</span>                  <span class=err>//</span> <span class=nf>Method</span> <span class=nf>java</span><span class=nv>/lang/Object.&#34;</span><span class=p>&lt;</span><span class=nf>init</span><span class=p>&gt;</span><span class=nf>&#34;:</span><span class=s>()</span><span class=nf>V</span>
         <span class=nf>4:</span> <span class=nf>return</span>
      <span class=nf>LineNumberTable:</span>
        <span class=nf>line</span> <span class=nf>1:</span> <span class=mf>0</span>
<span class=p>}</span>
<span class=nf>SourceFile:</span> <span class=nf>&#34;Demo.java&#34;</span>
</code></pre></div><p>第12个常量对应<code>java/lang/Object</code>，第4和5个常量为<code>&lt;init></code>和<code>()V</code>，所以第一个变量是<code>java/lang/Object."&lt;init>":()V</code>，实际指向类<code>Object</code>编译的初始化方法<code>&lt;init></code>。</p><p>接口常量就更加少了，这里不再继续说明了。</p><h3 id=access_flags>access_flags<a hidden class=anchor aria-hidden=true href=#access_flags>#</a></h3><p>access_flags为访问标志，共2个字节，用于表示某个类或者接口的访问权限及基础属性。<br>详细内容可查看<a href=https://blog.csdn.net/luanlouis/article/details/39892027 title="《Java虚拟机原理图解》 1.1、class文件基本组织结构">《Java虚拟机原理图解》 1.1、class文件基本组织结构</a>。</p><p><a href=https://blog.csdn.net/luanlouis/article/details/39892027 title="《Java虚拟机原理图解》 1.1、class文件基本组织结构"><img loading=lazy src=https://oss.dnfn.tech:1024/bedroom/2021/8/16/20210816150525.png alt=P2 title=access_flags></a></p><p>以前面的例子来看：</p><div class=highlight><pre class=chroma><code class=language-ps data-lang=ps>           <span class=mf>00</span> <span class=mf>01</span> <span class=mf>02</span> <span class=mf>03</span> <span class=mf>04</span> <span class=mf>05</span> <span class=mf>06</span> <span class=mf>07</span> <span class=mf>08</span> <span class=mf>09</span> <span class=nf>0A</span> <span class=nf>0B</span> <span class=nf>0C</span> <span class=nf>0D</span> <span class=nf>0E</span> <span class=nf>0F</span>

<span class=mf>00000070</span>   <span class=mf>62</span> <span class=nf>6A</span> <span class=mf>65</span> <span class=mf>63</span> <span class=mf>74</span> <span class=nf><span id=dye-20 idx=13 style=color:#4ff>00 21</span></span> <span class=mf>00</span> <span class=mf>02</span> <span class=mf>00</span> <span class=mf>03</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span>  <span class=nf>bject.!.........</span>
</code></pre></div><p>即：<code>ACC_SUPER</code>+<code>ACC_PUBLIC</code></p><h3 id=this_class>this_class<a hidden class=anchor aria-hidden=true href=#this_class>#</a></h3><p>当前类索引，即当前类或者接口在<code>constant_pool</code>中的位置索引。</p><p>以之前的例子来看：</p><div class=highlight><pre class=chroma><code class=language-ps data-lang=ps>           <span class=mf>00</span> <span class=mf>01</span> <span class=mf>02</span> <span class=mf>03</span> <span class=mf>04</span> <span class=mf>05</span> <span class=mf>06</span> <span class=mf>07</span> <span class=mf>08</span> <span class=mf>09</span> <span class=nf>0A</span> <span class=nf>0B</span> <span class=nf>0C</span> <span class=nf>0D</span> <span class=nf>0E</span> <span class=nf>0F</span>

<span class=mf>00000070</span>   <span class=mf>62</span> <span class=nf>6A</span> <span class=mf>65</span> <span class=mf>63</span> <span class=mf>74</span> <span class=mf>00</span> <span class=mf>21</span> <span class=nf><span id=dye-21 idx=14 style=color:#f03>00 02</span></span> <span class=mf>00</span> <span class=mf>03</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span>  <span class=nf>bject.!.........</span>
</code></pre></div><p><code>00 02</code>即是第2个，参见<a href=#M1>上文</a>。</p><h3 id=super_class>super_class<a hidden class=anchor aria-hidden=true href=#super_class>#</a></h3><p>父类索引，即当前类的父类在<code>constant_pool</code>中的索引。</p><p>以之前的例子来看：</p><div class=highlight><pre class=chroma><code class=language-ps data-lang=ps>           <span class=mf>00</span> <span class=mf>01</span> <span class=mf>02</span> <span class=mf>03</span> <span class=mf>04</span> <span class=mf>05</span> <span class=mf>06</span> <span class=mf>07</span> <span class=mf>08</span> <span class=mf>09</span> <span class=nf>0A</span> <span class=nf>0B</span> <span class=nf>0C</span> <span class=nf>0D</span> <span class=nf>0E</span> <span class=nf>0F</span>

<span class=mf>00000070</span>   <span class=mf>62</span> <span class=nf>6A</span> <span class=mf>65</span> <span class=mf>63</span> <span class=mf>74</span> <span class=mf>00</span> <span class=mf>21</span> <span class=mf>00</span> <span class=mf>02</span> <span class=nf><span id=dye-22 idx=15 style=color:#ff0>00 03</span></span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span>  <span class=nf>bject.!.........</span>
</code></pre></div><p>父类为第3个<a href=#M1>常量</a>class，也就是<code>Object</code>。<br>对于<code>Object</code>(没有父类)，则索引为0。<br>对于接口：</p><div class=highlight><pre class=chroma><code class=language-ps data-lang=ps><span class=mf>00000040</span>   <span class=mf>65</span> <span class=mf>63</span> <span class=mf>74</span> <span class=mf>06</span> <span class=mf>01</span> <span class=mf>00</span> <span class=mf>01</span> <span class=nf><span id=dye-23 idx=16 style=color:#06c>00 02</span></span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span>  <span class=nf>ect.............</span>
<span class=err>//</span> <span class=nf>javap</span> <span class=nf>-v</span> <span class=nf>Demo.class</span>
  <span class=nf>#2</span> <span class=nf>=</span> <span class=nf>Class</span>              <span class=nf>#6</span>              <span class=err>//</span> <span class=nf>java</span><span class=nv>/lang/Object</span>
</code></pre></div><p>只能是<code>Object</code>。</p><h3 id=接口表>接口表<a hidden class=anchor aria-hidden=true href=#接口表>#</a></h3><h4 id=interfaces_count>interfaces_count<a hidden class=anchor aria-hidden=true href=#interfaces_count>#</a></h4><p>接口计数器，占两个字节，interfaces_count的值表示当前类或接口的直接父接口数量。可为0。</p><h4 id=interfaces>interfaces<a hidden class=anchor aria-hidden=true href=#interfaces>#</a></h4><p>接口数组，长度为<code>interfaces_count</code>。数组中每一个元素必须是<code>constant_pool</code>中的一个<code>CONSANT_Class_info</code>常量。存储顺序与代码中提供的接口顺序相同。</p><p>上文无接口时，表示为</p><div class=highlight><pre class=chroma><code class=language-ps data-lang=ps>           <span class=mf>00</span> <span class=mf>01</span> <span class=mf>02</span> <span class=mf>03</span> <span class=mf>04</span> <span class=mf>05</span> <span class=mf>06</span> <span class=mf>07</span> <span class=mf>08</span> <span class=mf>09</span> <span class=nf>0A</span> <span class=nf>0B</span> <span class=nf>0C</span> <span class=nf>0D</span> <span class=nf>0E</span> <span class=nf>0F</span>

<span class=mf>00000070</span>   <span class=mf>62</span> <span class=nf>6A</span> <span class=mf>65</span> <span class=mf>63</span> <span class=mf>74</span> <span class=mf>00</span> <span class=mf>21</span> <span class=mf>00</span> <span class=mf>02</span> <span class=mf>00</span> <span class=mf>03</span> <span class=nf><span id=dye-24 idx=17 style=color:#f90>00 00</span></span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span>  <span class=nf>bject.!.........</span>
</code></pre></div><p>只有接口计数器的值<code>00 00</code></p><h3 id=字段表>字段表<a hidden class=anchor aria-hidden=true href=#字段表>#</a></h3><p>字段表同样由两个部分组成：<code>fields_count</code>和<code>fields</code>。</p><h4 id=fields_count>fields_count<a hidden class=anchor aria-hidden=true href=#fields_count>#</a></h4><p>字段计数器，共2个字节，表示当前Class文件<code>fields</code>数组的长度。可以为0。</p><h4 id=fields>fields<a hidden class=anchor aria-hidden=true href=#fields>#</a></h4><p>字段数组，字节大小不定，元素结构为<code>field_info</code>，长度为<code>fields_count</code>。只包含当前class文件定义的字段，继承的部分不在其中。</p><p><code>field_info</code>结构：</p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=n>field_info</span> <span class=p>{</span>
    <span class=n>u2</span>             <span class=n>access_flags</span><span class=p>;</span>
    <span class=n>u2</span>             <span class=n>name_index</span><span class=p>;</span>
    <span class=n>u2</span>             <span class=n>descriptor_index</span><span class=p>;</span>
    <span class=n>u2</span>             <span class=n>attributes_count</span><span class=p>;</span>
    <span class=n>attribute_info</span> <span class=n>attributes</span><span class=p>[</span><span class=n>attributes_count</span><span class=p>];</span>
<span class=p>}</span>
</code></pre></div><p>其中<code>name_index</code>和<code>descriptor_index</code>都是<code>constant_pool</code>的一个<code>CONSTANT_Utf8_info</code>索引。<br><code>attributes</code>结构与class文件的<code>attributes</code>结构一致，后文再讲。<br>当<code>fields_count</code>为0时，和接口表一样不会有数据区<code>fields</code>:</p><div class=highlight><pre class=chroma><code class=language-ps data-lang=ps>           <span class=mf>00</span> <span class=mf>01</span> <span class=mf>02</span> <span class=mf>03</span> <span class=mf>04</span> <span class=mf>05</span> <span class=mf>06</span> <span class=mf>07</span> <span class=mf>08</span> <span class=mf>09</span> <span class=nf>0A</span> <span class=nf>0B</span> <span class=nf>0C</span> <span class=nf>0D</span> <span class=nf>0E</span> <span class=nf>0F</span>

<span class=mf>00000070</span>   <span class=mf>62</span> <span class=nf>6A</span> <span class=mf>65</span> <span class=mf>63</span> <span class=mf>74</span> <span class=mf>00</span> <span class=mf>21</span> <span class=mf>00</span> <span class=mf>02</span> <span class=mf>00</span> <span class=mf>03</span> <span class=mf>00</span> <span class=mf>00</span> <span class=nf><span id=dye-25 idx=18 style=color:#ee2>00 00</span></span> <span class=mf>00</span>  <span class=nf>bject.!.........</span>
</code></pre></div><h3 id=方法表>方法表<a hidden class=anchor aria-hidden=true href=#方法表>#</a></h3><p>方法表同样分为两个部分：<code>methods_count</code>和<code>methods</code></p><h4 id=methods_count>methods_count<a hidden class=anchor aria-hidden=true href=#methods_count>#</a></h4><p>方法计数器，共占用两个字节，从0开始，表示当前class文件定义的方法数量，不包含继承的部分。</p><p>上文的例子中表示的位置：</p><div class=highlight><pre class=chroma><code class=language-ps data-lang=ps>           <span class=mf>00</span> <span class=mf>01</span> <span class=mf>02</span> <span class=mf>03</span> <span class=mf>04</span> <span class=mf>05</span> <span class=mf>06</span> <span class=mf>07</span> <span class=mf>08</span> <span class=mf>09</span> <span class=nf>0A</span> <span class=nf>0B</span> <span class=nf>0C</span> <span class=nf>0D</span> <span class=nf>0E</span> <span class=nf>0F</span>

<span class=mf>00000070</span>   <span class=mf>62</span> <span class=nf>6A</span> <span class=mf>65</span> <span class=mf>63</span> <span class=mf>74</span> <span class=mf>00</span> <span class=mf>21</span> <span class=mf>00</span> <span class=mf>02</span> <span class=mf>00</span> <span class=mf>03</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span> <span class=nf><span id=dye-26 idx=19 style=color:#0f4>00</span></span>  <span class=nf>bject.!.........</span>
<span class=mf>00000080</span>   <span class=nf><span id=dye-27 idx=20 style=color:#0f4>01</span></span> <span class=mf>00</span> <span class=mf>01</span> <span class=mf>00</span> <span class=mf>04</span> <span class=mf>00</span> <span class=mf>05</span> <span class=mf>00</span> <span class=mf>01</span> <span class=mf>00</span> <span class=mf>06</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span> <span class=nf>1D</span> <span class=mf>00</span>  <span class=nf>................</span>
</code></pre></div><p>只有一个方法。</p><h4 id=methods>methods<a hidden class=anchor aria-hidden=true href=#methods>#</a></h4><p>方法数组，长度不定，每个元素均为<code>method_info</code>。</p><p><code>method_info</code>数据结构：</p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=n>method_info</span> <span class=p>{</span>
    <span class=n>u2</span>             <span class=n>access_flags</span><span class=p>;</span>
    <span class=n>u2</span>             <span class=n>name_index</span><span class=p>;</span>
    <span class=n>u2</span>             <span class=n>descriptor_index</span><span class=p>;</span>
    <span class=n>u2</span>             <span class=n>attributes_count</span><span class=p>;</span>
    <span class=n>attribute_info</span> <span class=n>attributes</span><span class=p>[</span><span class=n>attributes_count</span><span class=p>];</span>
<span class=p>}</span>
</code></pre></div><p>和字段表元素结构类似，<code>name_index</code>和<code>descriptor_index</code>均是<code>constant_pool</code>中的一个<code>CONSTANT_Utf8_info</code>常量的索引。</p><p>以上文的例子数据来看：</p><div class=highlight><pre class=chroma><code class=language-ps data-lang=ps>           <span class=mf>00</span> <span class=mf>01</span> <span class=mf>02</span> <span class=mf>03</span> <span class=mf>04</span> <span class=mf>05</span> <span class=mf>06</span> <span class=mf>07</span> <span class=mf>08</span> <span class=mf>09</span> <span class=nf>0A</span> <span class=nf>0B</span> <span class=nf>0C</span> <span class=nf>0D</span> <span class=nf>0E</span> <span class=nf>0F</span>

<span class=mf>00000080</span>   <span class=mf>01</span> <span class=nf><span id=dye-28 idx=20 style=color:#4ff>00 01 00 04 00 05 00 01</span></span> <span class=mf>00</span> <span class=mf>06</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span> <span class=nf>1D</span> <span class=mf>00</span>  <span class=nf>................</span>
</code></pre></div><p>这里共8个字节，不包含<code>attributes</code>，相关常量查看<a href=#M1>上文</a>:</p><ul><li><code>00 01</code>: access_flags，访问标志：<code>ACC_PUBLIC</code></li><li><code>00 04</code>: name_index，方法名，常量表里的 <code>&lt;init></code></li><li><code>00 05</code>: descriptor_index，方法描述，常量表里的 <code>()V</code></li><li><code>00 01</code>: attributes_count，方法属性个数，1个</li></ul><p>方法的属性同类属性一起。</p><h3 id=属性表>属性表<a hidden class=anchor aria-hidden=true href=#属性表>#</a></h3><p>属性表同样也是两个部分组成：<code>attributes_count</code>和<code>attributes</code></p><h4 id=attributes_count>attributes_count<a hidden class=anchor aria-hidden=true href=#attributes_count>#</a></h4><p>属性计数器，共占2个字节，表示<code>attributes</code>数组元素的个数。</p><h4 id=attributes>attributes<a hidden class=anchor aria-hidden=true href=#attributes>#</a></h4><p>属性数组，大小不定，长度为<code>attributes_count</code>，每个元素的结构都是<code>attribute_info</code>，字段、方法、class文件都会用到。</p><p><code>attribute_info</code>数据结构：</p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=n>attribute_info</span> <span class=p>{</span>
    <span class=n>u2</span> <span class=n>attribute_name_index</span><span class=p>;</span>
    <span class=n>u4</span> <span class=n>attribute_length</span><span class=p>;</span>
    <span class=n>u1</span> <span class=n>info</span><span class=p>[</span><span class=n>attribute_length</span><span class=p>];</span>
<span class=p>}</span>
</code></pre></div><p>其中<code>attribute_name_index</code>表示的是属性名，其值为常量池<code>constant_pool</code>中的一个<code>CONSTANT_Utf8_info</code>常量的索引，属性内容长度用了4个字节表示。</p><p>class文件五个非常重要的属性：</p><ul><li>ConstantValue</li><li>Code</li><li>StackMapTable</li><li>Exceptions</li><li>BootstrapMethods</li></ul><p>详细属性可在<a href=https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html#jvms-4.7 title=Attributes>官网</a>了解，这里只简单说明下</p><p><code>Code</code>是<code>method_info</code>的一个属性，它包含方法体内容，其结构为</p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=n>Code_attribute</span> <span class=p>{</span>
    <span class=n>u2</span> <span class=n>attribute_name_index</span><span class=p>;</span>
    <span class=n>u4</span> <span class=n>attribute_length</span><span class=p>;</span>
    <span class=n>u2</span> <span class=n>max_stack</span><span class=p>;</span>
    <span class=n>u2</span> <span class=n>max_locals</span><span class=p>;</span>
    <span class=n>u4</span> <span class=n>code_length</span><span class=p>;</span>
    <span class=n>u1</span> <span class=n>code</span><span class=p>[</span><span class=n>code_length</span><span class=p>];</span>
    <span class=n>u2</span> <span class=n>exception_table_length</span><span class=p>;</span>
    <span class=p>{</span>   <span class=n>u2</span> <span class=n>start_pc</span><span class=p>;</span>
        <span class=n>u2</span> <span class=n>end_pc</span><span class=p>;</span>
        <span class=n>u2</span> <span class=n>handler_pc</span><span class=p>;</span>
        <span class=n>u2</span> <span class=n>catch_type</span><span class=p>;</span>
    <span class=p>}</span> <span class=n>exception_table</span><span class=p>[</span><span class=n>exception_table_length</span><span class=p>];</span>
    <span class=n>u2</span> <span class=n>attributes_count</span><span class=p>;</span>
    <span class=n>attribute_info</span> <span class=n>attributes</span><span class=p>[</span><span class=n>attributes_count</span><span class=p>];</span>
<span class=p>}</span>
</code></pre></div><p>方法体为<code>code_length</code>+<code>code[code_length]</code>，其他不再细说。</p><p>根据上文仅有的方法来看，它只有一个属性，也就是</p><div class=highlight><pre class=chroma><code class=language-ps data-lang=ps>           <span class=mf>00</span> <span class=mf>01</span> <span class=mf>02</span> <span class=mf>03</span> <span class=mf>04</span> <span class=mf>05</span> <span class=mf>06</span> <span class=mf>07</span> <span class=mf>08</span> <span class=mf>09</span> <span class=nf>0A</span> <span class=nf>0B</span> <span class=nf>0C</span> <span class=nf>0D</span> <span class=nf>0E</span> <span class=nf>0F</span>

<span class=mf>00000080</span>   <span class=mf>01</span> <span class=mf>00</span> <span class=mf>01</span> <span class=mf>00</span> <span class=mf>04</span> <span class=mf>00</span> <span class=mf>05</span> <span class=mf>00</span> <span class=mf>01</span> <span class=nf><span id=dye-29 idx=21 style=color:#f03>00 06</span></span> <span class=nf><span id=dye-30 idx=22 style=color:#ff0>00 00 00 1D</span></span> <span class=nf><span id=dye-31 idx=23 style=color:#06c>00</span></span>  <span class=nf>................</span>
<span class=mf>00000090</span>   <span class=nf><span id=dye-32 idx=24 style=color:#06c>01 00 01 00 00 00 05 2A B7 00 01 B1 00 00 00 01</span></span>  <span class=nf>.......*·..±....</span>
<span class=nf>000000A0</span>   <span class=nf><span id=dye-33 idx=24 style=color:#06c>00 07 00 00 00 06 00 01 00 00 00 01 00</span></span> <span class=mf>01</span> <span class=mf>00</span> <span class=mf>08</span>  <span class=nf>................</span>
<span class=nf>000000B0</span>   <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>02</span> <span class=mf>00</span> <span class=mf>09</span>                                <span class=nf>......</span>
</code></pre></div><p>常量表见<a href=#M1>上文</a></p><ul><li><code>00 06</code>: 属性名索引，值为<code>Code</code></li><li><code>00 00 00 00 1D</code>: 属性内容长度，值为30个字节</li></ul><p>内容根据<code>Code_attribute</code>的数据结构解析</p><p>max_stack：<code>00 01</code><br>max_locals：<code>00 01</code><br>code_length：<code>00 00 00 05</code><br>code[code_length]：<code>2A B7 00 01 B1</code><br>exception_table_length：<code>00 00</code><br>exception_table： 无<br>attributes_count：<code>00 01</code><br>attributes：<code>00 07 00 00 00 06 00 01 00 00 00 01 00</code></p><p><code>Code</code>中的<code>attributes</code>还有一个<code>00 07</code>表示的一个<code>LineNumberTable</code>，这里不做说明</p><p>剩下的字节也就是<code>class</code>文件的属性：</p><div class=highlight><pre class=chroma><code class=language-ps data-lang=ps>           <span class=mf>00</span> <span class=mf>01</span> <span class=mf>02</span> <span class=mf>03</span> <span class=mf>04</span> <span class=mf>05</span> <span class=mf>06</span> <span class=mf>07</span> <span class=mf>08</span> <span class=mf>09</span> <span class=nf>0A</span> <span class=nf>0B</span> <span class=nf>0C</span> <span class=nf>0D</span> <span class=nf>0E</span> <span class=nf>0F</span>

<span class=nf>000000A0</span>   <span class=mf>00</span> <span class=mf>07</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>06</span> <span class=mf>00</span> <span class=mf>01</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>00</span> <span class=mf>01</span> <span class=mf>00</span> <span class=nf><span id=dye-34 idx=24 style=color:#f90>01 00 08</span></span>  <span class=nf>................</span>
<span class=nf>000000B0</span>   <span class=nf><span id=dye-35 idx=25 style=color:#f90>00 00 00 02 00 09</span></span>                                <span class=nf>......</span>
</code></pre></div><p>这里表示的是<code>SourceFile</code>属性，其值为<code>Demo.java</code></p><h2 id=思考>思考<a hidden class=anchor aria-hidden=true href=#思考>#</a></h2><ul><li>Q：导入的静态方法是怎么表示的？<br>如果代码里没有用到，编译后会被优化。<code>import</code>的类和方法都会放入<code>constant_pool</code>中作为常量。</li></ul><h2 id=延伸>延伸<a hidden class=anchor aria-hidden=true href=#延伸>#</a></h2><ol><li><a href=https://blog.csdn.net/luanlouis/article/details/39892027 title="《Java虚拟机原理图解》 1.1、class文件基本组织结构">Class 文件基本组织结构</a></li><li><a href=https://en.wikipedia.org/wiki/Java_class_file title="Java class file - Wiki">Java class file - Wiki</a></li><li><a href=https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html title="JDK8虚拟机规范 - The class File Format">The class File Format</a></li></ol><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>一般描述为<strong>固定不变的值</strong>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div><footer class=post-footer><ul class=post-tags><li><a href=https://zone.dnfn.tech/tags/jdk/>jdk</a></li><li><a href=https://zone.dnfn.tech/tags/jvm/>jvm</a></li><li><a href=https://zone.dnfn.tech/tags/class/>class</a></li><li><a href=https://zone.dnfn.tech/tags/%E5%AD%97%E8%8A%82%E7%A0%81/>字节码</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Java Class 文件解析 on twitter" href="https://twitter.com/intent/tweet/?text=Java%20Class%20%e6%96%87%e4%bb%b6%e8%a7%a3%e6%9e%90&url=https%3a%2f%2fzone.dnfn.tech%2fpost%2f20210608875210%2f&hashtags=jdk%2cjvm%2cclass%2c%e5%ad%97%e8%8a%82%e7%a0%81"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Java Class 文件解析 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fzone.dnfn.tech%2fpost%2f20210608875210%2f&title=Java%20Class%20%e6%96%87%e4%bb%b6%e8%a7%a3%e6%9e%90&summary=Java%20Class%20%e6%96%87%e4%bb%b6%e8%a7%a3%e6%9e%90&source=https%3a%2f%2fzone.dnfn.tech%2fpost%2f20210608875210%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Java Class 文件解析 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fzone.dnfn.tech%2fpost%2f20210608875210%2f&title=Java%20Class%20%e6%96%87%e4%bb%b6%e8%a7%a3%e6%9e%90"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Java Class 文件解析 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fzone.dnfn.tech%2fpost%2f20210608875210%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Java Class 文件解析 on whatsapp" href="https://api.whatsapp.com/send?text=Java%20Class%20%e6%96%87%e4%bb%b6%e8%a7%a3%e6%9e%90%20-%20https%3a%2f%2fzone.dnfn.tech%2fpost%2f20210608875210%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Java Class 文件解析 on telegram" href="https://telegram.me/share/url?text=Java%20Class%20%e6%96%87%e4%bb%b6%e8%a7%a3%e6%9e%90&url=https%3a%2f%2fzone.dnfn.tech%2fpost%2f20210608875210%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer><div id=utter-container></div><script async type=text/javascript>(function(){function a(){var a=document.createElement('script');a.type='text/javascript',a.async=!0,a.setAttribute('issue-term','title'),a.setAttribute('theme','github-light'),a.setAttribute('repo','desiyonan/zone'),a.crossorigin='anonymous',a.src='https://utteranc.es/client.js',document.getElementById('utter-container').appendChild(a)}document.addEventListener&&document.addEventListener("DOMContentLoaded",a,!1)})()</script></article></main><footer class=footer><span>&copy; 2026 <a href=https://zone.dnfn.tech>DnF's Zone</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script><script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script></body></html>