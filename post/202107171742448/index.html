<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>OAuth2理解和疑惑 | DnF's Zone</title><meta name=keywords content="web,auth,oauth2,user-agent"><meta name=description content="简介
本文适合对OAuth2已经有一定了解的开发人员，没有说到几种具体的模式流程，仅仅写下我自己对授权oauth2的理解，还有一些疑问和解答，希望对阅读的人有所帮助，如果有什么建议可以直接联系笔者。关于具体的模式讲解和实例我就留到后续文章中一一道来。"><meta name=author content="DnF"><link rel=canonical href=https://zone.dnfn.tech/post/202107171742448/><link crossorigin=anonymous href=/assets/css/stylesheet.min.2282d1157d794f784bf9f62038687785053b90d8a0d04ecf047df2b7852bb448.css integrity="sha256-IoLRFX15T3hL+fYgOGh3hQU7kNig0E7PBH3yt4UrtEg=" rel="preload stylesheet" as=style><link rel=preload href=/favicon.svg as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://zone.dnfn.tech/favicon.svg><link rel=icon type=image/png sizes=16x16 href=https://zone.dnfn.tech/favicon.svg><link rel=icon type=image/png sizes=32x32 href=https://zone.dnfn.tech/favicon.svg><link rel=apple-touch-icon href=https://zone.dnfn.tech/apple-touch-icon.png><link rel=mask-icon href=https://zone.dnfn.tech/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.83.1"><meta property="og:title" content="OAuth2理解和疑惑"><meta property="og:description" content="简介
本文适合对OAuth2已经有一定了解的开发人员，没有说到几种具体的模式流程，仅仅写下我自己对授权oauth2的理解，还有一些疑问和解答，希望对阅读的人有所帮助，如果有什么建议可以直接联系笔者。关于具体的模式讲解和实例我就留到后续文章中一一道来。"><meta property="og:type" content="article"><meta property="og:url" content="https://zone.dnfn.tech/post/202107171742448/"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-07-17T16:24:48+08:00"><meta property="article:modified_time" content="2021-07-17T16:24:48+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="OAuth2理解和疑惑"><meta name=twitter:description content="简介
本文适合对OAuth2已经有一定了解的开发人员，没有说到几种具体的模式流程，仅仅写下我自己对授权oauth2的理解，还有一些疑问和解答，希望对阅读的人有所帮助，如果有什么建议可以直接联系笔者。关于具体的模式讲解和实例我就留到后续文章中一一道来。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://zone.dnfn.tech/post/"},{"@type":"ListItem","position":3,"name":"OAuth2理解和疑惑","item":"https://zone.dnfn.tech/post/202107171742448/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"OAuth2理解和疑惑","name":"OAuth2理解和疑惑","description":"简介 本文适合对OAuth2已经有一定了解的开发人员，没有说到几种具体的模式流程，仅仅写下我自己对授权oauth2的理解，还有一些疑问和解答，希望对阅读的人有所帮助，如果有什么建议可以直接联系笔者。关于具体的模式讲解和实例我就留到后续文章中一一道来。\n","keywords":["web","auth","oauth2","user-agent"],"articleBody":"简介 本文适合对OAuth2已经有一定了解的开发人员，没有说到几种具体的模式流程，仅仅写下我自己对授权oauth2的理解，还有一些疑问和解答，希望对阅读的人有所帮助，如果有什么建议可以直接联系笔者。关于具体的模式讲解和实例我就留到后续文章中一一道来。\n了解授权 什么是授权 简单来说就是将自己的权限给其他人，让他可以完成相应的工作任务。\n这里实际有个主动被动的关系，一般开发中的授权都是说的被动式的（请求用户授予权限）。\n为什么需要授权 互联网作为一个的庞大网络，其中有海量的服务提供方，而我们个人作为这些服务的使用者，通常需要对不同的服务提供相同的信息（比如身份、学历、联系方式等等），而这不就相当于自己把个人信息从一个已有的服务系统拷贝另一个新的服务系统中吗？不想自己做，嫌麻烦了也可以委托其他人来拷贝，但再此之前得找自己信得过帮手让他代替自己（你肯定不希望随便一个陌生人盗用自己得信息），为了不同服务间资源数据的安全共享，所以需要授权！\n怎么授权 注：怎么授权换言之就是授权方式，先思考有哪些授权方式，它们可能会遇到的问题和处理方式，至于它们具体实现细节这里不做过多描述。\n在了解怎么授权的之前，先思考授权这个过程涉及到了哪些角色（自己的理解，比较片面）：\n 用户：资源数据的所有方 服务提供方：需要共享资源数据给外部的服务 服务使用方：第三方服务、外部服务、接入方、调用方  授权行为：用户将自己在服务提供方的权限（部分或全部）给服务使用方，使服务使用方可进行相关权限的操作。\n最简单的授权无非是服务提供方将用户的帐号密码给第三方系统（服务使用方），但这是建立在非常信任情况下（应该没有正常人会把自家大门钥匙给一个从未见面的陌生人吧）\n共享帐号密码实现确实简单直接，但这真的没有弊端吗？\n试想自己作为服务提供方采用这种方案，将会有哪些问题？\n 要是哪天用户的密码换了，又怎么让第三方系统能继续访问资源？（同步帐号密码必然遇到更多问题！） 又或者是哪天第三方其中的一个不再可信，不能再给他权限了，如何保证在不影响用户和其他第三方系统的情况下对其限制？ 再说如果给了帐号密码，就相当于用户在操作，又怎么知道用户是否真的出于意愿来进行操作？（难以保证第三方不会滥用帐号密码） 更需要注意的是权限，比如第三方系统已知用户帐号密码，那他是否可以修改用户的密码？  以上只是想到的一部分问题，估计要解决这些问题又得牺牲为数不多的头发。\n如果站在被授权方（服务使用方）的角度，这些问题都不算事，只要你给密码，我能完成工作，那就没问题！\n但是站在授权方（服务提供方）的角度，那就不得不重视了，不仅是为了用户，也是为了本系统的安全！\n从服务提供方的角度来考虑的话，怎么授权才能避免上面的问题？\n 当然是不与第三方共享密码，或者直接由用户提供帐号密码授权 需要验证第三方服务的身份，不是任何人都可以随便接入授权服务 让用户参与到过程中（提供帐号密码、确认授权范围、确认人为操作）  所以授权是最好三方（服务提供方、服务使用方、用户）一起参与才最真实可靠，简单的说就是\n 不止校验用户是否有意愿来完成授权 还要看服务使用方是否是可信的  以共享用户帐号密码的方式为例，首先只有完全可信的第三方（服务使用方）才能共享帐号密码，但用户是否真的有意愿使用功能那就不得而知了（问题3）。\n那么如何做到这些呢？\n从OAuth2 授权码模式中可以总结出了这样的答案：\n 服务使用方在服务提供方注册自己的身份信息用于验证是否可信（client_id、client_sercet等） 通过重定向页面让用户确认授权信息（用户信息通过用户登录或者已登录的会话获得，从而关联用户信息和服务使用方）  前面说到直接与多个外部系统共享用户帐号密码的方式将面临的问题，正好可以基于以上两点来解决：\n 用户更改密码，并不影响第三方系统（被授权方）在服务提供方已注册的身份信息，两者是独立的 各第三方系统（被授权方）在服务提供方注册的信息也是相互独立的，限制其中一个并不影响其他第三方系统 不止第三方系统，用户也参与了授权（重定向页面验证用户身份） 用户可以根据自己的意愿来确认是否授权（比如授予修改密码的权限）  当然不能避免的是引入需要考虑的新问题：\n 如何避免第三方系统身份信息的泄露、被盗用的情况（类似用户帐号密码泄露的情况） 用户直接参与授权验证，交互会更加复杂，给外部的可乘之机就越多 用户的每次授权的时效性（只有一段时间内可用，避免一次授权一直使用，当然也存在特殊场景） 如何避免用户被钓鱼授权（用户在本系统已登录认证过，然后在互联网点击攻击者放置的钓鱼链接以获取其他正规网站的授权）  等等一系列问题，不过现在不需太过深入在意。\n以上是个人学习OAuth2.0授权码模式同时思考的总结，总而言之授权过程的需要考虑：\n 服务使用方是否是可信的 用户信息是否真实 用户是否有意愿来完成授权 互联网的一些安全问题  注：如果已经了解过OAuth2.0的密码模式，或许会注意到该模式并没有验证服务使用方的信息（client_id、client_sercet等），可以说是从传统的用户帐号密码验证演变来的，能提供帐号密码既是可信的（被盗和泄露另说），官方文档上说明(需保密就用授权码模式)：\n If the client type is confidential or the client was issued client\ncredentials (or assigned other authentication requirements), the\nclient MUST authenticate with the authorization server as described\nin Section 3.2.1.\n OAuth2.0授权 首先，和上面思考怎么授权之前一样，OAuth2.0对涉及的角色给出了相关定义。\n resource owner: 资源拥有者，可以理解成常见的用户。\nclient：客户端，请求被授权的应用。可以理解授权服务的使用方。\nresource server：实际提供资源数据的服务器\nauthorization server: 授权服务器\n 在我的理解中，resource server+authorization server可以合称为服务提供方，因为这两者相对服务使用者来说是一方的。只是这里根据各自的职责定义更加详细具体。\n再看OAuth 2.0的抽象运行流程如下图，摘自RFC 6749。\n\n这个图我在我学习OAuth2.0的整个过程中至少看到过五次，然而就算一遍又一遍其中的每一步的意义，始终感觉自己哪里不明白（不知道有人跟我一样不）\n起初我有些困惑这个图为啥和自己印象中的OAuth2.0授权流程不一样，几经思考还是暂时放在一边\n后来才逐渐反应过来这不过是抽象的授权协议流程（印象中的是几个模式具体的流程）\n但紧接着我又疑惑了：为什么抽象的授权协议流程是这样的？与几个模式具体的流程差异这么大？这样的流程有什么好处？\n抽象的授权流程换言之意味着最符合理想效果的流程，所以我反过来思考什么是理想的授权效果？通常的授权方式又有哪里不尽人意？该怎样授权？\n设想一个情景：找人装修 角色： 1. 我们：高大上小区的物业和门卫 2. 张三：他在我们小区刚买了套新房，平时996 3. 李四：老实巴交专门接私活干的装修工 事件：张三请李四帮他装修房子 星期一早上10点，李四拎着他的麻袋来给张三干活。 我一瞧，这么大一个麻袋干嘛的，难不成是人口贩子？不行，得好好盘问盘问：“你谁？来这干嘛得？”。 李四憨厚一笑道：“我是来装修得，张三请我来的，就是1栋2单元3楼4户的业主”。 1234号业主不刚好是物业上面那户程序猿吗，确实是刚买房子还没装，最近常来物业转悠还算挺熟的，我一皱眉，刚想开口再问时，就见他放下麻袋，抽裤兜里掏出一张对半折的整整齐齐的纸条递给我。 “这是张三他给我的委托书，你给看看呢。”他憨笑着摸了摸后脑勺说到。 我接过纸条展开一看眉头一展，这歪七拐八的字确实是那苦逼程序猿张三的真迹，而且这人老实巴交的看也不像假话。“行吧，这委托书我就收下了，你跟我去物业来办个临时工作证，后面就用它进出吧。” 于是李四老老实实跟着我办了证，天天拿着他的临时出入证勤勤恳恳去帮张三装房子去了。 可以代入不同角色去思考，这里从物业门卫的角度考虑，是为了确保小区内的所有居民的安全，不只是特例张三。\n整理下几者之间是如何交互的：\n 张三、李四早就知道李四是没法直接进小区的，所以张三事先给李四整了一张能证实张三身份并说明李四事由的委托书。 李四将委托书交由交由门卫进行验证真实性，并为其办理临时出入证。 李四使用临时身份证开始自己的工作  当然这里只是举个例子，要是思考：为啥张三不直接带李四一起进去？又或者为啥要整个委托书，不直接电话？…等等类似问题，那就说明考虑的很全面。不过这里简单抽象就够了（你可以把张三自己看着证明，或者张三的电话回答是证明），到最后也就是上面的OAuth2.0抽象流程图。\n话说回OAuth2.0抽象流程图具体步骤：\nA：Client找Resource Owner要一个凭据，为了完成他委托自己办的事 B：Resource Owner给Client一个凭据，这个凭据同时记录了委托人、被委托人、委托事项等 C：Client将凭据给Authorization server进行验证（这里只是抽象流程，验证真实性的方式不需太过深入） D：Authorization server觉得凭据没啥问题，再给了Client整个临时访问的令牌用 E：Client拿着令牌到Resource server确认，并告知他想干嘛 F：Client完成自己的工作，并从Resource server得到想要的结果数据 这不就像：\n 张三是Resource Owner 李四是Client 物业门卫是Authorization server  或许你会在意Resource server体现在哪，E、F步骤怎么体现？可以理解就是小区门禁。\n这个流程的难点无疑在于B步骤（授权方式）：\n Resource Owner如何授予权限给Client？ Authorization Server如何知道B步骤是真实的？也就是C步骤Client提供的授权凭据是真实的  答案是重定向，也就是OAuth2中说到的引导用户到指定页面（密码、客户端模式下不需要）。\n授权码模式下，Client引导Resource Owner到Authorization Server的授权页面，同时会附带自己的身份信息，而Authorization Server的授权页面还需要知道是谁来赋权，所以通常还需要Resource Owner登录一次（或者从已登录的会话中获取用户信息）来确定。\n从交互上来看，Authorization Server就像是Resource Owner给Client赋予权限这件事的见证者、记录者。以前面的例子来说，就像是：李四拿的委托书新来的门卫不认，需要到物业处申请专门规定的表单，他签字登记身份信息和事由，然后找来张三签字确认授权，并由物业盖章才能证明。\n关于具体的授权方式就这里写就太长了，先留个新坑吧~\n解惑   Q：为什么要分别定义Authorization Server和Resource Server？\n 两者是抽象概念，实际可以是不同服务器，也可以是同一服务器甚至同一服务。抽象主要是依据职责，而且由于微服务和分布式等的概念，单一职责更易于复用，从而达到一个授权服务器发布的授权也可以用于多个资源服务器目的。\n   Q：为什么大量交互都是使用重定向的，而不是后台直接调用接口？\n 首先，后台调用接口方式也是有的，但仅限于Client请求Authorization Server获取Token时（授权码模式下），剩余交互都是通过重定向，为什么如此？为什么在用户确认授权时Authorization Server不直接将Token通过调用接口方式返回给Client，这样不是更简单高效？\n其实原因主要在于Authorization Server可能无法访问Client给的重定向地址，比如不同域下、重定向地址需要当前已登录的用户信息等等。一个简单的例子在局域网内对接外网服务认证（比如Github），或者使用带有localhost的地址作为结果处理端点，这样授权服务器是无法连接客户端的，但是用户代理（通常指浏览器）一定知道，所以重定向更加适用，而且也可减轻授权服务的压力。\n   Q：为什么授权码模式需要有一步Code，再换取Token？\n 与简化模式不同，授权码模式多出一步授权Code请求，而不是直接返回Token，这样做的目的肯定是为了更安全！\n上一个问题说到为什么使用重定向，然而这样也会带来困难，直接返回Token会暴露给外部、甚至攻击者（实际上简化模式就是这样做的，但迫不得已才会采用这种授权方式），所以中间添加了一步Code，但Code就不会暴露吗？会，同样的！但是没关系，因为只拿到Code是没有用的，还得需要一个东西，也就是client_sercet。\n在授权码模式中Client身份实际有两个东西结合认证的：client_id与client_sercet，client_id通过用户代理的url参数早已经暴露在网络中，只能表示是谁，而client_sercet不同，它只有在Client主动调用请求Authorization Server的Token接口时才使用，也就是能使用client_sercet一定是他自己（或者类似集群的），Code结合client_sercet一起使用在授予Token时先确认Client的身份准确无误，这就是Code的意义，确保Token只被对的人获取。\n而在简化模式中不能使用client_sercet(一般没有后端服务程序，但前端传输会暴露，所以不能使用)，这样就不能校验Client的身份，那么Code在简化模式中也就没有意义，还不如直接请求Token来的实在。\n   Q：授权权码模式下，获取Token时redirect_uri需要和获取Code是相同的？\n 一开始我以为两个redirect_uri都会用来重定向，但实际上只有请求Code后才会发生一次重定向(Authorization Server - Client)，获取Token的接口参数redirect_uri是为了校验前面的请求，保持一致性，防止外部攻击。\n   Q：为什么简化模式不校验client_sercet直接获取到Access token?\n 校验不了，参考问题：为什么授权码模式需要有一步Code，再换取Token？\n更多文章：stackoverflow\n   Q：简化模式的token获取脚本（web-hosted client resource）指的是从授权服务器、Client的Web服务器还是资源服务器?\n 我觉得时Client的Web服务器上的一个脚本，但图例中既有web-hosted client resource又有Client，实在令人混淆，但实际的重定向目标地址时之前Client提供的redirect_uri，也就是Client的资源路径之一（专门用于获取url上hash片段里的Token的页面）。\n更多文章：stackoverflow等。\n   Q：关于参数state有什么意义\n 保持请求设备一致性，也就是防止CSRF攻击，简单的说就是攻击者用他已有的帐号和他的state向授权服务器申请Authorization Grant后，用其伪造一个链接或图片让用户点击，这样用户以为他授权的是自己帐号，但实际是攻击者专门的帐号，之后用户的所有操作都可被攻击者看见，如果向该帐号推送数据（比如保存文件，帐号密码，转账等等），那就完蛋了！所以说对state进行校验是有必要的，要是传出的和传入的state不等，那直接拒绝就完事了!\nstate 如果为固定值的话意义不大，攻击者知道了就形同摆设，最好是动态的（例如会话的hash值）！\n可以从以下文章中了解更多\n 关于 OAuth2.0 安全性你应该要知道的一些事 移花接木：针对OAuth2的CSRF攻击 技术干货 | OAuth2.0的安全解析     Q：资源服务器在接受每个请求时，是怎么判断令牌的真实有效性的？\n 这部分实际不在OAuth2协议规范里。通常验证需要资源服务器与授权服务器交互协调，也可以通过其他方式，例如中间件（Redis）或者JWT实现。\n   Q：认证和授权的区别？\n 二者实际不一样，但又有一定联系，一时间有些混淆。\n认证：辨认证实身份。通常指的是程序和用户二者之间的交互，程序需要知道用户到底是谁？登录认证便是一种。\n授权：授予权限访问。通常指的是三者交互（用户、服务提供方、服务使用方），服务使用方请求用户将他（用户）在服务提供方的部分或全部权限授予自己（服务使用方）。\n区别：认证更倾向于用户是谁！授权更倾向于能替哪个用户干什么事！一般认证后，拥有对整个帐号的功能数据的所有权力，但授权后仅限于被已认证的用户授予的部分。\n联系：授权时一般涉及到用户身份认证。\n   参考  OAuth 2.0 的一个简单解释 - 阮一峰 理解OAuth2.0 - 阮一峰 OAuth 2.0 的四种方式 - 阮一峰 OAuth2.0 详解 - 知乎 The OAuth 2.0 Authorization Framework - rfc6749 从“黑掉Github”学Web安全开发 OAuth 2.0 Tutorial 关于 OAuth2.0 安全性你应该要知道的一些事 - chrisyue 移花接木：针对OAuth2的CSRF攻击 技术干货 | OAuth2.0的安全解析 OAuth2授权码模式详细流程（一）——站在OAuth2设计者的角度来理解code  ","wordCount":"6728","inLanguage":"zh","datePublished":"2021-07-17T16:24:48+08:00","dateModified":"2021-07-17T16:24:48+08:00","author":{"@type":"Person","name":"DnF"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zone.dnfn.tech/post/202107171742448/"},"publisher":{"@type":"Organization","name":"DnF's Zone","logo":{"@type":"ImageObject","url":"https://zone.dnfn.tech/favicon.svg"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://zone.dnfn.tech accesskey=h title="DnF's Zone (Alt + H)">DnF's Zone</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://zone.dnfn.tech/search title=搜索><span>搜索</span></a></li><li><a href=https://zone.dnfn.tech/categories title=分类><span>分类</span></a></li><li><a href=https://zone.dnfn.tech/tags title=标签><span>标签</span></a></li><li><a href=https://zone.dnfn.tech/series title=系列><span>系列</span></a></li><li><a href=https://zone.dnfn.tech/archive title=归档><span>归档</span></a></li><li><a href=https://zone.dnfn.tech/about title=码夫><span>码夫</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://zone.dnfn.tech>Home</a>&nbsp;»&nbsp;<a href=https://zone.dnfn.tech/post/>Posts</a></div><h1 class=post-title>OAuth2理解和疑惑</h1><div class=post-meta>2021-07-17&nbsp;·&nbsp;DnF</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>目录</div></summary><div class=inner><ul><li><a href=#%e7%ae%80%e4%bb%8b aria-label=简介>简介</a></li><li><a href=#%e4%ba%86%e8%a7%a3%e6%8e%88%e6%9d%83 aria-label=了解授权>了解授权</a><ul><li><a href=#%e4%bb%80%e4%b9%88%e6%98%af%e6%8e%88%e6%9d%83 aria-label=什么是授权>什么是授权</a></li><li><a href=#%e4%b8%ba%e4%bb%80%e4%b9%88%e9%9c%80%e8%a6%81%e6%8e%88%e6%9d%83 aria-label=为什么需要授权>为什么需要授权</a></li><li><a href=#%e6%80%8e%e4%b9%88%e6%8e%88%e6%9d%83 aria-label=怎么授权>怎么授权</a></li></ul></li><li><a href=#oauth20%e6%8e%88%e6%9d%83 aria-label=OAuth2.0授权>OAuth2.0授权</a></li><li><a href=#%e8%a7%a3%e6%83%91 aria-label=解惑>解惑</a></li><li><a href=#%e5%8f%82%e8%80%83 aria-label=参考>参考</a></li></ul></div></details></div><div class=post-content><h2 id=简介>简介<a hidden class=anchor aria-hidden=true href=#简介>#</a></h2><p>本文适合对<code>OAuth2</code>已经有一定了解的开发人员，没有说到几种具体的模式流程，仅仅写下我自己对授权<code>oauth2</code>的理解，还有一些疑问和解答，希望对阅读的人有所帮助，如果有什么建议可以直接联系笔者。关于具体的模式讲解和实例我就留到后续文章中一一道来。</p><h2 id=了解授权>了解授权<a hidden class=anchor aria-hidden=true href=#了解授权>#</a></h2><h3 id=什么是授权>什么是授权<a hidden class=anchor aria-hidden=true href=#什么是授权>#</a></h3><p>简单来说就是将自己的权限给其他人，让他可以完成相应的工作任务。<br>这里实际有个主动被动的关系，一般开发中的授权都是说的被动式的（请求用户授予权限）。</p><h3 id=为什么需要授权>为什么需要授权<a hidden class=anchor aria-hidden=true href=#为什么需要授权>#</a></h3><p>互联网作为一个的庞大网络，其中有海量的服务提供方，而我们个人作为这些服务的使用者，通常需要对不同的服务提供相同的信息（比如身份、学历、联系方式等等），而这不就相当于自己把个人信息从一个已有的服务系统拷贝另一个新的服务系统中吗？不想自己做，嫌麻烦了也可以委托其他人来拷贝，但再此之前得找自己信得过帮手让他代替自己（你肯定不希望随便一个陌生人盗用自己得信息），为了不同服务间资源数据的安全共享，所以需要授权！</p><h3 id=怎么授权>怎么授权<a hidden class=anchor aria-hidden=true href=#怎么授权>#</a></h3><p>注：怎么授权换言之就是授权方式，先思考有哪些授权方式，它们可能会遇到的问题和处理方式，至于它们具体实现细节这里不做过多描述。</p><p>在了解怎么授权的之前，先思考授权这个过程涉及到了哪些角色（自己的理解，比较片面）：</p><ul><li>用户：资源数据的所有方</li><li>服务提供方：需要共享资源数据给外部的服务</li><li>服务使用方：第三方服务、外部服务、接入方、调用方</li></ul><p>授权行为：用户将自己在服务提供方的权限（部分或全部）给服务使用方，使服务使用方可进行相关权限的操作。</p><p>最简单的授权无非是服务提供方将用户的帐号密码给第三方系统（服务使用方），但这是建立在非常信任情况下（应该没有正常人会把自家大门钥匙给一个从未见面的陌生人吧）</p><p>共享帐号密码实现确实简单直接，但这真的没有弊端吗？</p><p>试想自己作为服务提供方采用这种方案，将会有哪些问题？</p><ol><li>要是哪天用户的密码换了，又怎么让第三方系统能继续访问资源？（同步帐号密码必然遇到更多问题！）</li><li>又或者是哪天第三方其中的一个不再可信，不能再给他权限了，如何保证在不影响用户和其他第三方系统的情况下对其限制？</li><li><dfn id=M1></dfn>再说如果给了帐号密码，就相当于用户在操作，又怎么知道用户是否真的出于意愿来进行操作？（难以保证第三方不会滥用帐号密码）</li><li>更需要注意的是权限，比如第三方系统已知用户帐号密码，那他是否可以修改用户的密码？</li></ol><p>以上只是想到的一部分问题，估计要解决这些问题又得牺牲为数不多的头发。</p><p>如果站在<strong>被授权方</strong>（服务使用方）的角度，这些问题都不算事，只要你给密码，我能完成工作，那就没问题！<br>但是站在<strong>授权方</strong>（服务提供方）的角度，那就不得不重视了，不仅是为了用户，也是为了本系统的安全！</p><p>从服务提供方的角度来考虑的话，怎么授权才能避免上面的问题？</p><ol><li>当然是不与第三方共享密码，或者直接由用户提供帐号密码授权</li><li>需要验证第三方服务的身份，不是任何人都可以随便接入授权服务</li><li>让用户参与到过程中（提供帐号密码、确认授权范围、确认人为操作）</li></ol><p>所以授权是最好三方（服务提供方、服务使用方、用户）一起参与才最真实可靠，简单的说就是</p><ol><li>不止校验用户是否有意愿来完成授权</li><li>还要看服务使用方是否是可信的</li></ol><p>以共享用户帐号密码的方式为例，首先只有完全可信的第三方（服务使用方）才能共享帐号密码，但用户是否真的有意愿使用功能那就不得而知了（<a href=#M1>问题3</a>）。</p><p>那么如何做到这些呢？</p><p>从OAuth2 授权码模式中可以总结出了这样的答案：</p><ol><li>服务使用方在服务提供方注册自己的身份信息用于验证是否可信（<code>client_id</code>、<code>client_sercet</code>等）</li><li>通过重定向页面让用户确认授权信息（用户信息通过用户登录或者已登录的会话获得，从而关联用户信息和服务使用方）</li></ol><p>前面说到直接与多个外部系统共享用户帐号密码的方式将面临的问题，正好可以基于以上两点来解决：</p><ol><li>用户更改密码，并不影响第三方系统（被授权方）在服务提供方已注册的身份信息，两者是独立的</li><li>各第三方系统（被授权方）在服务提供方注册的信息也是相互独立的，限制其中一个并不影响其他第三方系统</li><li>不止第三方系统，用户也参与了授权（重定向页面验证用户身份）</li><li>用户可以根据自己的意愿来确认是否授权（比如授予修改密码的权限）</li></ol><p>当然不能避免的是引入需要考虑的新问题：</p><ol><li>如何避免第三方系统身份信息的泄露、被盗用的情况（类似用户帐号密码泄露的情况）</li><li>用户直接参与授权验证，交互会更加复杂，给外部的可乘之机就越多</li><li>用户的每次授权的时效性（只有一段时间内可用，避免一次授权一直使用，当然也存在特殊场景）</li><li>如何避免用户被钓鱼授权（用户在本系统已登录认证过，然后在互联网点击攻击者放置的钓鱼链接以获取其他正规网站的授权）</li></ol><p>等等一系列问题，不过现在不需太过深入在意。</p><p>以上是个人学习OAuth2.0授权码模式同时思考的总结，总而言之授权过程的需要考虑：</p><ol><li>服务使用方是否是可信的</li><li>用户信息是否真实</li><li>用户是否有意愿来完成授权</li><li>互联网的一些安全问题</li></ol><p>注：如果已经了解过OAuth2.0的密码模式，或许会注意到该模式并没有验证服务使用方的信息（<code>client_id</code>、<code>client_sercet</code>等），可以说是从传统的用户帐号密码验证演变来的，能提供帐号密码既是可信的（被盗和泄露另说），<a href=https://datatracker.ietf.org/doc/html/rfc6749 title="The OAuth 2.0 Authorization Framework">官方文档</a>上说明(需保密就用授权码模式)：</p><blockquote><p>If the client type is confidential or the client was issued client<br>credentials (or assigned other authentication requirements), the<br>client MUST authenticate with the authorization server as described<br>in Section 3.2.1.</p></blockquote><h2 id=oauth20授权>OAuth2.0授权<a hidden class=anchor aria-hidden=true href=#oauth20授权>#</a></h2><p>首先，和上面思考怎么授权之前一样，OAuth2.0对涉及的角色给出了相关<a href=https://datatracker.ietf.org/doc/html/rfc6749 title="The OAuth 2.0 Authorization Framework">定义</a>。</p><blockquote><p>resource owner: 资源拥有者，可以理解成常见的用户。<br>client：客户端，请求被授权的应用。可以理解授权服务的使用方。<br>resource server：实际提供资源数据的服务器<br>authorization server: 授权服务器</p></blockquote><p>在我的理解中，<code>resource server</code>+<code>authorization server</code>可以合称为服务提供方，因为这两者相对服务使用者来说是一方的。只是这里根据各自的职责定义更加详细具体。</p><p>再看OAuth 2.0的抽象运行流程如下图，摘自<a href=https://datatracker.ietf.org/doc/html/rfc6749 title="The OAuth 2.0 Authorization Framework">RFC 6749</a>。</p><p><a href=https://oss.dnfn.tech:1024/bedroom/2021/8/3/20210803161505.png#center title="Figure 1: Abstract Protocol Flow"><img loading=lazy src=https://oss.dnfn.tech:1024/bedroom/2021/8/3/20210803161505.png#center alt="Figure 1: Abstract Protocol Flow" title="Figure 1: Abstract Protocol Flow"></a></p><p>这个图我在我学习OAuth2.0的整个过程中至少看到过五次，然而就算一遍又一遍其中的每一步的意义，始终感觉自己哪里不明白（不知道有人跟我一样不）</p><p>起初我有些困惑这个图为啥和自己印象中的OAuth2.0授权流程不一样，几经思考还是暂时放在一边</p><p>后来才逐渐反应过来这不过是抽象的授权协议流程（印象中的是几个模式具体的流程）</p><p>但紧接着我又疑惑了：为什么抽象的授权协议流程是这样的？与几个模式具体的流程差异这么大？这样的流程有什么好处？</p><p>抽象的授权流程换言之意味着最符合理想效果的流程，所以我反过来思考什么是理想的授权效果？通常的授权方式又有哪里不尽人意？该怎样授权？</p><div class=highlight><pre class=chroma><code class=language-md data-lang=md>设想一个情景：找人装修

角色：

<span class=k>1.</span> 我们：高大上小区的物业和门卫
<span class=k>2.</span> 张三：他在我们小区刚买了套新房，平时996
<span class=k>3.</span> 李四：老实巴交专门接私活干的装修工

事件：张三请李四帮他装修房子

星期一早上10点，李四拎着他的麻袋来给张三干活。

我一瞧，这么大一个麻袋干嘛的，难不成是人口贩子？不行，得好好盘问盘问：“你谁？来这干嘛得？”。
李四憨厚一笑道：“我是来装修得，张三请我来的，就是1栋2单元3楼4户的业主”。

1234号业主不刚好是物业上面那户程序猿吗，确实是刚买房子还没装，最近常来物业转悠还算挺熟的，我一皱眉，刚想开口再问时，就见他放下麻袋，抽裤兜里掏出一张对半折的整整齐齐的纸条递给我。

“这是张三他给我的委托书，你给看看呢。”他憨笑着摸了摸后脑勺说到。

我接过纸条展开一看眉头一展，这歪七拐八的字确实是那苦逼程序猿张三的真迹，而且这人老实巴交的看也不像假话。“行吧，这委托书我就收下了，你跟我去物业来办个临时工作证，后面就用它进出吧。”

于是李四老老实实跟着我办了证，天天拿着他的临时出入证勤勤恳恳去帮张三装房子去了。
</code></pre></div><p>可以代入不同角色去思考，这里从物业门卫的角度考虑，是为了确保小区内的所有居民的安全，不只是特例张三。</p><p>整理下几者之间是如何交互的：</p><ol><li>张三、李四早就知道李四是没法直接进小区的，所以张三事先给李四整了一张能证实张三身份并说明李四事由的委托书。</li><li>李四将委托书交由交由门卫进行验证真实性，并为其办理临时出入证。</li><li>李四使用临时身份证开始自己的工作</li></ol><p>当然这里只是举个例子，要是思考：为啥张三不直接带李四一起进去？又或者为啥要整个委托书，不直接电话？&mldr;等等类似问题，那就说明考虑的很全面。不过这里简单抽象就够了（你可以把张三自己看着证明，或者张三的电话回答是证明），到最后也就是上面的OAuth2.0抽象流程图。</p><p>话说回OAuth2.0抽象流程图具体步骤：</p><div class=highlight><pre class=chroma><code class=language-md data-lang=md>A：Client找Resource Owner要一个凭据，为了完成他委托自己办的事
B：Resource Owner给Client一个凭据，这个凭据同时记录了委托人、被委托人、委托事项等
C：Client将凭据给Authorization server进行验证（这里只是抽象流程，验证真实性的方式不需太过深入）
D：Authorization server觉得凭据没啥问题，再给了Client整个临时访问的令牌用
E：Client拿着令牌到Resource server确认，并告知他想干嘛
F：Client完成自己的工作，并从Resource server得到想要的结果数据
</code></pre></div><p>这不就像：</p><ol><li>张三是Resource Owner</li><li>李四是Client</li><li>物业门卫是Authorization server</li></ol><p>或许你会在意Resource server体现在哪，E、F步骤怎么体现？可以理解就是小区门禁。</p><p>这个流程的难点无疑在于B步骤（授权方式）：</p><ol><li><code>Resource Owner</code>如何授予权限给<code>Client</code>？</li><li><code>Authorization Server</code>如何知道B步骤是真实的？也就是C步骤<code>Client</code>提供的授权凭据是真实的</li></ol><p>答案是重定向，也就是OAuth2中说到的引导用户到指定页面（密码、客户端模式下不需要）。</p><p>授权码模式下，<code>Client</code>引导<code>Resource Owner</code>到<code>Authorization Server</code>的授权页面，同时会附带自己的身份信息，而<code>Authorization Server</code>的授权页面还需要知道是谁来赋权，所以通常还需要<code>Resource Owner</code>登录一次（或者从已登录的会话中获取用户信息）来确定。</p><p>从交互上来看，<code>Authorization Server</code>就像是<code>Resource Owner</code>给<code>Client</code>赋予权限这件事的见证者、记录者。以前面的例子来说，就像是：李四拿的委托书新来的门卫不认，需要到物业处申请专门规定的表单，他签字登记身份信息和事由，然后找来张三签字确认授权，并由物业盖章才能证明。</p><p>关于具体的授权方式就这里写就太长了，先留个新坑吧~</p><h2 id=解惑>解惑<a hidden class=anchor aria-hidden=true href=#解惑>#</a></h2><ul><li><p>Q：为什么要分别定义<code>Authorization Server</code>和<code>Resource Server</code>？</p><blockquote><p>两者是抽象概念，实际可以是不同服务器，也可以是同一服务器甚至同一服务。抽象主要是依据职责，而且由于微服务和分布式等的概念，单一职责更易于复用，从而达到一个授权服务器发布的授权也可以用于多个资源服务器目的。</p></blockquote></li><li><p>Q：为什么大量交互都是使用重定向的，而不是后台直接调用接口？</p><blockquote><p>首先，后台调用接口方式也是有的，但仅限于<code>Client</code>请求<code>Authorization Server</code>获取<code>Token</code>时（授权码模式下），剩余交互都是通过重定向，为什么如此？为什么在用户确认授权时<code>Authorization Server</code>不直接将<code>Token</code>通过调用接口方式返回给<code>Client</code>，这样不是更简单高效？<br>其实原因主要在于<code>Authorization Server</code>可能无法访问<code>Client</code>给的重定向地址，比如不同域下、重定向地址需要当前已登录的用户信息等等。一个简单的例子在局域网内对接外网服务认证（比如Github），或者使用带有<code>localhost</code>的地址作为结果处理端点，这样授权服务器是无法连接客户端的，但是用户代理（通常指浏览器）一定知道，所以重定向更加适用，而且也可减轻授权服务的压力。</p></blockquote></li><li><p>Q：为什么授权码模式需要有一步<code>Code</code>，再换取<code>Token</code>？</p><blockquote><p>与简化模式不同，授权码模式多出一步授权<code>Code</code>请求，而不是直接返回<code>Token</code>，这样做的目的肯定是为了更安全！<br>上一个问题说到为什么使用重定向，然而这样也会带来困难，直接返回<code>Token</code>会暴露给外部、甚至攻击者（实际上简化模式就是这样做的，但迫不得已才会采用这种授权方式），所以中间添加了一步<code>Code</code>，但<code>Code</code>就不会暴露吗？会，同样的！但是没关系，因为只拿到<code>Code</code>是没有用的，还得需要一个东西，也就是<code>client_sercet</code>。<br>在授权码模式中<code>Client</code>身份实际有两个东西结合认证的：<code>client_id</code>与<code>client_sercet</code>，<code>client_id</code>通过用户代理的url参数早已经暴露在网络中，只能表示是谁，而<code>client_sercet</code>不同，它只有在<code>Client</code><strong>主动调用</strong>请求<code>Authorization Server</code>的<code>Token</code>接口时才使用，也就是能使用<code>client_sercet</code>一定是他自己（或者类似集群的），<code>Code</code>结合<code>client_sercet</code>一起使用在授予<code>Token</code>时先确认<code>Client</code>的身份准确无误，这就是<code>Code</code>的意义，确保<code>Token</code>只被对的人获取。<br>而在简化模式中不能使用<code>client_sercet</code>(一般没有后端服务程序，但前端传输会暴露，所以不能使用)，这样就不能校验<code>Client</code>的身份，那么<code>Code</code>在简化模式中也就没有意义，还不如直接请求<code>Token</code>来的实在。</p></blockquote></li><li><p>Q：授权权码模式下，获取<code>Token</code>时<code>redirect_uri</code>需要和获取<code>Code</code>是相同的？</p><blockquote><p>一开始我以为两个<code>redirect_uri</code>都会用来重定向，但实际上只有请求<code>Code</code>后才会发生一次重定向(<code>Authorization Server</code> -> <code>Client</code>)，获取<code>Token</code>的接口参数<code>redirect_uri</code>是为了校验前面的请求，保持一致性，防止<a href=https://www.rfc-editor.org/rfc/rfc6749.html#section-10.6 title="10.6.  Authorization Code Redirection URI Manipulation">外部攻击</a>。</p></blockquote></li><li><p>Q：为什么简化模式不校验<code>client_sercet</code>直接获取到<code>Access token</code>?</p><blockquote><p>校验不了，参考问题：为什么授权码模式需要有一步<code>Code</code>，再换取<code>Token</code>？<br>更多文章：<a href=http://stackoverflow.com/questions/13387698/why-is-there-an-authorization-code-flow-in-oauth2-when-implicit-flow-works-s title=stackoverflow>stackoverflow</a></p></blockquote></li><li><p>Q：简化模式的token获取脚本（<code>web-hosted client resource</code>）指的是从授权服务器、<code>Client</code>的Web服务器还是资源服务器?</p><blockquote><p>我觉得时<code>Client</code>的Web服务器上的一个脚本，但图例中既有<code>web-hosted client resource</code>又有<code>Client</code>，实在令人混淆，但实际的重定向目标地址时之前<code>Client</code>提供的<code>redirect_uri</code>，也就是<code>Client</code>的资源路径之一（专门用于获取url上hash片段里的<code>Token</code>的页面）。<br>更多文章：<a href=https://stackoverflow.com/questions/23780909/why-does-the-implicit-authorization-grant-in-oauth-require-a-web-hosted-client title="Why does the Implicit Authorization Grant in OAuth require a “Web-hosted Client Resource”?">stackoverflow</a>等。</p></blockquote></li><li><p>Q：关于参数<code>state</code>有什么意义</p><blockquote><p>保持请求设备一致性，也就是防止<code>CSRF</code>攻击，简单的说就是攻击者用他已有的帐号和他的<code>state</code>向授权服务器申请<code>Authorization Grant</code>后，用其伪造一个链接或图片让用户点击，这样用户以为他授权的是自己帐号，但实际是攻击者专门的帐号，之后用户的所有操作都可被攻击者看见，如果向该帐号推送数据（比如保存文件，帐号密码，转账等等），那就完蛋了！所以说对<code>state</code>进行校验是有必要的，要是传出的和传入的<code>state</code>不等，那直接拒绝就完事了!<br><code>state</code> 如果为固定值的话意义不大，攻击者知道了就形同摆设，最好是动态的（例如会话的hash值）！<br>可以从以下文章中了解更多</p><ol><li><a href=https://www.chrisyue.com/security-issue-about-oauth-2-0-you-should-know.html title="关于 OAuth2.0 安全性你应该要知道的一些事">关于 OAuth2.0 安全性你应该要知道的一些事</a></li><li><a href=https://www.jianshu.com/p/c7c8f51713b6 title=移花接木：针对OAuth2的CSRF攻击>移花接木：针对OAuth2的CSRF攻击</a></li><li><a href=https://zhuanlan.zhihu.com/p/214107728 title="技术干货 | OAuth2.0的安全解析">技术干货 | OAuth2.0的安全解析</a></li></ol></blockquote></li><li><p>Q：资源服务器在接受每个请求时，是怎么判断令牌的真实有效性的？</p><blockquote><p>这部分实际不在OAuth2协议规范里。通常验证需要资源服务器与授权服务器交互协调，也可以通过其他方式，例如中间件（Redis）或者JWT实现。</p></blockquote></li><li><p>Q：认证和授权的区别？</p><blockquote><p>二者实际不一样，但又有一定联系，一时间有些混淆。<br>认证：辨认证实身份。通常指的是程序和用户二者之间的交互，程序需要知道用户到底是谁？登录认证便是一种。<br>授权：授予权限访问。通常指的是三者交互（用户、服务提供方、服务使用方），服务使用方请求用户将他（用户）在服务提供方的部分或全部权限授予自己（服务使用方）。<br>区别：认证更倾向于用户是谁！授权更倾向于能替哪个用户干什么事！一般认证后，拥有对整个帐号的功能数据的所有权力，但授权后仅限于被已认证的用户授予的部分。<br>联系：授权时一般涉及到用户身份认证。</p></blockquote></li></ul><h2 id=参考>参考<a hidden class=anchor aria-hidden=true href=#参考>#</a></h2><ol><li><a href=https://www.ruanyifeng.com/blog/2019/04/oauth_design.html title="OAuth 2.0 的一个简单解释">OAuth 2.0 的一个简单解释</a> - 阮一峰</li><li><a href=https://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html title=理解OAuth2.0>理解OAuth2.0</a> - 阮一峰</li><li><a href=https://www.ruanyifeng.com/blog/2019/04/oauth-grant-types.html title="OAuth 2.0 的四种方式">OAuth 2.0 的四种方式</a> - 阮一峰</li><li><a href=https://zhuanlan.zhihu.com/p/89020647 title="OAuth2.0 详解">OAuth2.0 详解</a> - 知乎</li><li><a href=https://datatracker.ietf.org/doc/html/rfc6749 title="The OAuth 2.0 Authorization Framework">The OAuth 2.0 Authorization Framework</a> - rfc6749</li><li><a href=https://coolshell.cn/articles/11021.html title=从“黑掉Github”学Web安全开发>从“黑掉Github”学Web安全开发</a></li><li><a href=http://tutorials.jenkov.com/oauth2/index.html title="OAuth 2.0 Tutorial">OAuth 2.0 Tutorial</a></li><li><a href=https://www.chrisyue.com/security-issue-about-oauth-2-0-you-should-know.html title="关于 OAuth2.0 安全性你应该要知道的一些事">关于 OAuth2.0 安全性你应该要知道的一些事</a> - chrisyue</li><li><a href=https://www.jianshu.com/p/c7c8f51713b6 title=移花接木：针对OAuth2的CSRF攻击>移花接木：针对OAuth2的CSRF攻击</a></li><li><a href=https://zhuanlan.zhihu.com/p/214107728 title="技术干货 | OAuth2.0的安全解析">技术干货 | OAuth2.0的安全解析</a></li><li><a href=https://mp.weixin.qq.com/s/vQ76tdxF7uoyTZz4cPL3gw title=OAuth2授权码模式详细流程（一）——站在OAuth2设计者的角度来理解code>OAuth2授权码模式详细流程（一）——站在OAuth2设计者的角度来理解code</a></li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://zone.dnfn.tech/tags/web/>web</a></li><li><a href=https://zone.dnfn.tech/tags/auth/>auth</a></li><li><a href=https://zone.dnfn.tech/tags/oauth2/>oauth2</a></li><li><a href=https://zone.dnfn.tech/tags/user-agent/>user-agent</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share OAuth2理解和疑惑 on twitter" href="https://twitter.com/intent/tweet/?text=OAuth2%e7%90%86%e8%a7%a3%e5%92%8c%e7%96%91%e6%83%91&url=https%3a%2f%2fzone.dnfn.tech%2fpost%2f202107171742448%2f&hashtags=web%2cauth%2coauth2%2cuser-agent"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share OAuth2理解和疑惑 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fzone.dnfn.tech%2fpost%2f202107171742448%2f&title=OAuth2%e7%90%86%e8%a7%a3%e5%92%8c%e7%96%91%e6%83%91&summary=OAuth2%e7%90%86%e8%a7%a3%e5%92%8c%e7%96%91%e6%83%91&source=https%3a%2f%2fzone.dnfn.tech%2fpost%2f202107171742448%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share OAuth2理解和疑惑 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fzone.dnfn.tech%2fpost%2f202107171742448%2f&title=OAuth2%e7%90%86%e8%a7%a3%e5%92%8c%e7%96%91%e6%83%91"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share OAuth2理解和疑惑 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fzone.dnfn.tech%2fpost%2f202107171742448%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share OAuth2理解和疑惑 on whatsapp" href="https://api.whatsapp.com/send?text=OAuth2%e7%90%86%e8%a7%a3%e5%92%8c%e7%96%91%e6%83%91%20-%20https%3a%2f%2fzone.dnfn.tech%2fpost%2f202107171742448%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share OAuth2理解和疑惑 on telegram" href="https://telegram.me/share/url?text=OAuth2%e7%90%86%e8%a7%a3%e5%92%8c%e7%96%91%e6%83%91&url=https%3a%2f%2fzone.dnfn.tech%2fpost%2f202107171742448%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer><div id=utter-container></div><script async type=text/javascript>(function(){function a(){var a=document.createElement('script');a.type='text/javascript',a.async=!0,a.setAttribute('issue-term','title'),a.setAttribute('theme','github-light'),a.setAttribute('repo','desiyonan/zone'),a.crossorigin='anonymous',a.src='https://utteranc.es/client.js',document.getElementById('utter-container').appendChild(a)}document.addEventListener&&document.addEventListener("DOMContentLoaded",a,!1)})()</script></article></main><footer class=footer><span>&copy; 2026 <a href=https://zone.dnfn.tech>DnF's Zone</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script><script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script></body></html>